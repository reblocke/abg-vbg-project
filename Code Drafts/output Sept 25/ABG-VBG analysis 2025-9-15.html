<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brian Locke, Anila Mehta">

<title>ABG-VBG Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ABG-VBG analysis 2025-9-15_files/libs/clipboard/clipboard.min.js"></script>
<script src="ABG-VBG analysis 2025-9-15_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="ABG-VBG analysis 2025-9-15_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="ABG-VBG analysis 2025-9-15_files/libs/quarto-html/popper.min.js"></script>
<script src="ABG-VBG analysis 2025-9-15_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ABG-VBG analysis 2025-9-15_files/libs/quarto-html/anchor.min.js"></script>
<link href="ABG-VBG analysis 2025-9-15_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ABG-VBG analysis 2025-9-15_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ABG-VBG analysis 2025-9-15_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ABG-VBG analysis 2025-9-15_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ABG-VBG analysis 2025-9-15_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ABG-VBG Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brian Locke, Anila Mehta </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="data-pre-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-pre-processing">Data Pre-processing</h2>
<p>This code pulls in the master database (a STATA file) and does some initial cleaning - this will only need to be run once, and then the data can be accessed in the usual way.</p>
<p><strong>BL 7/26/25</strong> - new: I augmented this code block to check for all needed packages, and important everything up front</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consolidated package management ------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>required_pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WeightIt"</span>, <span class="st">"broom"</span>, <span class="st">"cobalt"</span>, <span class="st">"codebookr"</span>, <span class="st">"dplyr"</span>, <span class="st">"flextable"</span>, <span class="st">"parallel"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gbm"</span>, <span class="st">"ggplot2"</span>, <span class="st">"gt"</span>, <span class="st">"gtsummary"</span>, <span class="st">"haven"</span>, <span class="st">"labelled"</span>, <span class="st">"scales"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"modelsummary"</span>, <span class="st">"officer"</span>, <span class="st">"patchwork"</span>, <span class="st">"rms"</span>, <span class="st">"survey"</span>, <span class="st">"tibble"</span>, <span class="st">"lubridate"</span>, <span class="st">"sensitivitymw"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Install any missing packages (with dependencies)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>missing_pkgs <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(required_pkgs, <span class="fu">rownames</span>(<span class="fu">installed.packages</span>()))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_pkgs)) {</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(missing_pkgs, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Load (or attach) all required packages</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(required_pkgs, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: WeightIt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: broom</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: cobalt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code> cobalt (Version 4.6.0, Build Date: 2025-04-15)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: codebookr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: dplyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: flextable</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: parallel</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: gbm</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded gbm 2.2.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This version of gbm is no longer under development. Consider transitioning to gbm3, https://github.com/gbm-developers/gbm3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: gt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: gtsummary</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gtsummary'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:flextable':

    continuous_summary</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: haven</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: labelled</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: scales</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: modelsummary</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: officer</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: patchwork</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: rms</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Hmisc</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Hmisc'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:modelsummary':

    Mean</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:gt':

    html</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    src, summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    format.pval, units</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rms'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:WeightIt':

    calibrate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: survey</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: survival</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'survey'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:rms':

    calibrate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:Hmisc':

    deff</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:WeightIt':

    calibrate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    dotchart</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tibble</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lubridate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sensitivitymw</code></pre>
</div>
</div>
<p>Converts the data from a STATA format to rdata if the rdata file does not exist. If it does already exist, it just loads that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_dir_name &lt;- '/Users/blocke/Box Sync/Residency Personal Files/Scholarly Work/Locke Research Projects/abg-vbg-project/data' # 'data/' this is changed from just</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>data_dir_name <span class="ot">&lt;-</span> <span class="st">'/Users/reblocke/Research/abg-vbg-project/data'</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>rdata_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir_name, <span class="st">"full_trinetx.rdata"</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>stata_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir_name, <span class="st">"full_db.dta"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(data_dir_name)) {</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(data_dir_name)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Directory 'data' created."</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Directory 'data' already exists."</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Directory 'data' already exists.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(rdata_file)) {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(rdata_file)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Loaded existing dataset from 'full_trinetx.rdata'."</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"RData file not found. Reading Stata dataset..."</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  stata_data <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(stata_file)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Extracting variable labels..."</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_label</span>(stata_data)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Extracting value labels..."</span>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(stata_data, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="fu">is.labelled</span>(x)) <span class="fu">val_labels</span>(x))</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(stata_data, <span class="at">file =</span> rdata_file)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Dataset saved as 'full_trinetx.rdata'."</span>)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(rdata_file)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Loaded newly saved dataset from 'full_trinetx.rdata'."</span>)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded existing dataset from 'full_trinetx.rdata'.</code></pre>
</div>
</div>
<p>Creating subset_data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>rows_to_keep <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(stata_data) <span class="sc">*</span> <span class="fl">1.0</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> stata_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(stata_data), rows_to_keep), ]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(subset_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 833476    546</code></pre>
</div>
</div>
<p>Generating Codebook for the Full Dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Generating codebook for the dataset..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Generating codebook for the dataset...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>study_codebook <span class="ot">&lt;-</span> codebookr<span class="sc">::</span><span class="fu">codebook</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  stata_data,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Full TrinetX"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"Dataset Documentation"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="st">"This dataset contains patient-level records from the TrinetX database. </span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="st">                 It has been processed and converted from the original Stata file."</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>codebook_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir_name, <span class="st">"codebookr.docx"</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(study_codebook, codebook_file)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Codebook saved as 'codebookr.docx' in the data directory."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Codebook saved as 'codebookr.docx' in the data directory.</code></pre>
</div>
</div>
<p>New Variable - Death at 60 days</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 1. Did the patient die?</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">died =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(death_date), <span class="dv">1</span>L, <span class="dv">0</span>L),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 2. Absolute death date (if death_date is an offset)</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">death_abs =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(death_date),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                        encounter_date <span class="sc">+</span> death_date,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">as.Date</span>(<span class="cn">NA</span>)),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 3. Year month (YM) for encounter and death</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">enc_ym   =</span> <span class="fu">floor_date</span>(encounter_date, <span class="at">unit =</span> <span class="st">"month"</span>),</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">death_ym =</span> <span class="fu">floor_date</span>(death_abs      , <span class="at">unit =</span> <span class="st">"month"</span>),</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 4. Reference censoring date: 1 Jun 2024</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref_ym =</span> <span class="fu">ymd</span>(<span class="st">"2024-06-01"</span>),</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 5. Months from encounter to death or censoring</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">months_death_or_cens =</span> <span class="fu">case_when</span>(</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(death_ym) <span class="sc">~</span> <span class="fu">interval</span>(enc_ym, death_ym) <span class="sc">%/%</span> <span class="fu">months</span>(<span class="dv">1</span>),</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>             <span class="sc">~</span> <span class="fu">interval</span>(enc_ym, ref_ym)   <span class="sc">%/%</span> <span class="fu">months</span>(<span class="dv">1</span>)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 6. Remove impossible values</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">months_death_or_cens =</span> <span class="fu">if_else</span>(</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>      months_death_or_cens <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> months_death_or_cens <span class="sc">&gt;</span> <span class="dv">16</span>,</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_integer_</span>, months_death_or_cens</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 7. Death within one or two months</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">died_1mo =</span> <span class="fu">if_else</span>(died <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> months_death_or_cens <span class="sc">&lt;</span>  <span class="dv">1</span>, <span class="dv">1</span>L, <span class="dv">0</span>L),</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">died_2mo =</span> <span class="fu">if_else</span>(died <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> months_death_or_cens <span class="sc">&lt;=</span> <span class="dv">1</span>, <span class="dv">1</span>L, <span class="dv">0</span>L),</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 8. Month of death (missing if censored)</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">death_time =</span> <span class="fu">if_else</span>(died <span class="sc">==</span> <span class="dv">1</span>, months_death_or_cens, <span class="cn">NA_integer_</span>),</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 9. Death within 60 days (new variable)</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">death_60d =</span> <span class="fu">if_else</span>(died <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> death_abs <span class="sc">&lt;=</span> (encounter_date <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">60</span>)), <span class="dv">1</span>L, <span class="dv">0</span>L)</span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>enc_ym, <span class="sc">-</span>death_ym)</span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">death_60d =</span> <span class="fu">if_else</span>(died <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> death_abs <span class="sc">&lt;=</span> (encounter_date <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">60</span>)), <span class="dv">1</span>L, <span class="dv">0</span>L)</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(subset_data<span class="sc">$</span>death_60d, <span class="at">useNA =</span> <span class="st">"ifany"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     0      1 
775835  57641 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(subset_data<span class="sc">$</span>death_60d, <span class="at">useNA =</span> <span class="st">"ifany"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
         0          1 
0.93084264 0.06915736 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(subset_data<span class="sc">$</span>death_60d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.00000 0.00000 0.06916 0.00000 1.00000 </code></pre>
</div>
</div>
<p>Table 1A and 1B:</p>
<p>adjusted version of the same table</p>
<ul class="task-list">
<li><p><label><input type="checkbox" checked="">TODO: I’d use race_ethnicity rather than just race. I updated this in the regression and IPW but haven’t yet in the table.</label></p></li>
<li><p><label><input type="checkbox" checked="">TODO: need to add location (= region in the US) to this.</label></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust derivation of analysis variables + helper for Table&nbsp;1 production</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># helper: label binary 0/1 → "No"/"Yes"</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>bin_lab <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">factor</span>(x, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span> </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="do">## ensure 0/1 numerics (avoids factor‑level coercion)</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(has_abg, has_vbg, hypercap_on_abg, hypercap_on_vbg),</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(.))),</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="do">## derive ABG / VBG hypercapnia groups</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    abg_group</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> <span class="fu">case_when</span>(</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>      has_abg <span class="sc">==</span> <span class="dv">0</span>                         <span class="sc">~</span> <span class="st">"No ABG"</span>,</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>      has_abg <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> hypercap_on_abg <span class="sc">==</span> <span class="dv">0</span>  <span class="sc">~</span> <span class="st">"ABG_NoHypercapnia"</span>,</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>      has_abg <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> hypercap_on_abg <span class="sc">==</span> <span class="dv">1</span>  <span class="sc">~</span> <span class="st">"ABG_Hypercapnia"</span>,</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                                 <span class="sc">~</span> <span class="st">"Missing"</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">vbg_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>      has_vbg <span class="sc">==</span> <span class="dv">0</span>                         <span class="sc">~</span> <span class="st">"No VBG"</span>,</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>      has_vbg <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> hypercap_on_vbg <span class="sc">==</span> <span class="dv">0</span>  <span class="sc">~</span> <span class="st">"VBG_NoHypercapnia"</span>,</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>      has_vbg <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> hypercap_on_vbg <span class="sc">==</span> <span class="dv">1</span>  <span class="sc">~</span> <span class="st">"VBG_Hypercapnia"</span>,</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                                 <span class="sc">~</span> <span class="st">"Missing"</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>    <span class="do">## factorise groups with explicit NA/Missing level</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">abg_group =</span> <span class="fu">factor</span>(</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>      abg_group,</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No ABG"</span>, <span class="st">"ABG_NoHypercapnia"</span>, <span class="st">"ABG_Hypercapnia"</span>, <span class="st">"Missing"</span>)</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">vbg_group =</span> <span class="fu">factor</span>(</span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>      vbg_group,</span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No VBG"</span>, <span class="st">"VBG_NoHypercapnia"</span>, <span class="st">"VBG_Hypercapnia"</span>, <span class="st">"Missing"</span>)</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>    <span class="do">## labelled covariates</span></span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex_label      =</span> <span class="fu">factor</span>(sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>)),</span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">race_ethnicity_label     =</span> <span class="fu">factor</span>(</span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>      race_ethnicity,</span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Black or African American"</span>, <span class="st">"Hispanic"</span>,</span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Asian"</span>, <span class="st">"American Indian"</span>, <span class="st">"Pacific Islander"</span>, <span class="st">"Unknown"</span>)</span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">location_label     =</span> <span class="fu">factor</span>(</span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true" tabindex="-1"></a>      location,</span>
<span id="cb67-48"><a href="#cb67-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb67-49"><a href="#cb67-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"South"</span>, <span class="st">"Northeast"</span> ,<span class="st">"Midwest"</span>, <span class="st">"West"</span>)</span>
<span id="cb67-50"><a href="#cb67-50" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb67-51"><a href="#cb67-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">osa_label      =</span> <span class="fu">bin_lab</span>(osa),</span>
<span id="cb67-52"><a href="#cb67-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">asthma_label   =</span> <span class="fu">bin_lab</span>(asthma),</span>
<span id="cb67-53"><a href="#cb67-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">copd_label     =</span> <span class="fu">bin_lab</span>(copd),</span>
<span id="cb67-54"><a href="#cb67-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">chf_label      =</span> <span class="fu">bin_lab</span>(chf),</span>
<span id="cb67-55"><a href="#cb67-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">nmd_label      =</span> <span class="fu">bin_lab</span>(nmd),</span>
<span id="cb67-56"><a href="#cb67-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">phtn_label     =</span> <span class="fu">bin_lab</span>(phtn),</span>
<span id="cb67-57"><a href="#cb67-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">ckd_label      =</span> <span class="fu">bin_lab</span>(ckd),</span>
<span id="cb67-58"><a href="#cb67-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">diabetes_label =</span> <span class="fu">bin_lab</span>(dm)</span>
<span id="cb67-59"><a href="#cb67-59" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-60"><a href="#cb67-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-61"><a href="#cb67-61" aria-hidden="true" tabindex="-1"></a><span class="co"># variables to summarise</span></span>
<span id="cb67-62"><a href="#cb67-62" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb67-63"><a href="#cb67-63" aria-hidden="true" tabindex="-1"></a>  <span class="st">"age_at_encounter"</span>, <span class="st">"curr_bmi"</span>, <span class="st">"sex_label"</span>, <span class="st">"race_ethnicity_label"</span>, <span class="st">"location_label"</span>,</span>
<span id="cb67-64"><a href="#cb67-64" aria-hidden="true" tabindex="-1"></a>  <span class="st">"osa_label"</span>, <span class="st">"asthma_label"</span>, <span class="st">"copd_label"</span>, <span class="st">"chf_label"</span>, <span class="st">"nmd_label"</span>,</span>
<span id="cb67-65"><a href="#cb67-65" aria-hidden="true" tabindex="-1"></a>  <span class="st">"phtn_label"</span>, <span class="st">"ckd_label"</span>, <span class="st">"diabetes_label"</span>, <span class="st">"vbg_co2"</span>, <span class="st">"paco2"</span></span>
<span id="cb67-66"><a href="#cb67-66" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-67"><a href="#cb67-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-68"><a href="#cb67-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Table&nbsp;1 constructor</span></span>
<span id="cb67-69"><a href="#cb67-69" aria-hidden="true" tabindex="-1"></a>make_table1 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, group_var, <span class="at">caption =</span> <span class="st">""</span>) {</span>
<span id="cb67-70"><a href="#cb67-70" aria-hidden="true" tabindex="-1"></a>  group_sym <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">sym</span>(group_var)</span>
<span id="cb67-71"><a href="#cb67-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-72"><a href="#cb67-72" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span> </span>
<span id="cb67-73"><a href="#cb67-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span>group_sym),                   <span class="co"># drop explicit NA</span></span>
<span id="cb67-74"><a href="#cb67-74" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!!</span>group_sym <span class="sc">!=</span> <span class="st">"Missing"</span>) <span class="sc">%&gt;%</span>          <span class="co"># drop “Missing” cohort</span></span>
<span id="cb67-75"><a href="#cb67-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">droplevels</span>() <span class="sc">%&gt;%</span>                              <span class="co"># trim empty factor levels</span></span>
<span id="cb67-76"><a href="#cb67-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(group_var, vars))) <span class="sc">%&gt;%</span> </span>
<span id="cb67-77"><a href="#cb67-77" aria-hidden="true" tabindex="-1"></a>    gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(</span>
<span id="cb67-78"><a href="#cb67-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">by   =</span> <span class="sc">!!</span>group_sym,</span>
<span id="cb67-79"><a href="#cb67-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="fu">list</span>(sex_label <span class="sc">~</span> <span class="st">"categorical"</span>),</span>
<span id="cb67-80"><a href="#cb67-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">statistic =</span> <span class="fu">list</span>(</span>
<span id="cb67-81"><a href="#cb67-81" aria-hidden="true" tabindex="-1"></a>        gtsummary<span class="sc">::</span><span class="fu">all_continuous</span>()  <span class="sc">~</span> <span class="st">"{mean} ± {sd}; {N_miss}/{N_obs} missing ({p_miss}%)"</span>,</span>
<span id="cb67-82"><a href="#cb67-82" aria-hidden="true" tabindex="-1"></a>        gtsummary<span class="sc">::</span><span class="fu">all_categorical</span>() <span class="sc">~</span> <span class="st">"{n} ({p}%)"</span></span>
<span id="cb67-83"><a href="#cb67-83" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb67-84"><a href="#cb67-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits   =</span> <span class="fu">list</span>(gtsummary<span class="sc">::</span><span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb67-85"><a href="#cb67-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">missing  =</span> <span class="st">"no"</span>                               <span class="co"># no gtsummary missing column/row</span></span>
<span id="cb67-86"><a href="#cb67-86" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb67-87"><a href="#cb67-87" aria-hidden="true" tabindex="-1"></a>    gtsummary<span class="sc">::</span><span class="fu">modify_header</span>(<span class="at">label =</span> <span class="st">"**Variable**"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb67-88"><a href="#cb67-88" aria-hidden="true" tabindex="-1"></a>    gtsummary<span class="sc">::</span><span class="fu">modify_caption</span>(caption)</span>
<span id="cb67-89"><a href="#cb67-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-90"><a href="#cb67-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-91"><a href="#cb67-91" aria-hidden="true" tabindex="-1"></a><span class="co"># build tables</span></span>
<span id="cb67-92"><a href="#cb67-92" aria-hidden="true" tabindex="-1"></a>table1A <span class="ot">&lt;-</span> <span class="fu">make_table1</span>(subset_data, <span class="st">"abg_group"</span>, <span class="at">caption =</span> <span class="st">"Table&nbsp;1A: ABG cohorts"</span>)</span>
<span id="cb67-93"><a href="#cb67-93" aria-hidden="true" tabindex="-1"></a>table1B <span class="ot">&lt;-</span> <span class="fu">make_table1</span>(subset_data, <span class="st">"vbg_group"</span>, <span class="at">caption =</span> <span class="st">"Table&nbsp;1B: VBG cohorts"</span>)</span>
<span id="cb67-94"><a href="#cb67-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-95"><a href="#cb67-95" aria-hidden="true" tabindex="-1"></a>table1A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ahftjiwpna" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ahftjiwpna table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ahftjiwpna thead, #ahftjiwpna tbody, #ahftjiwpna tfoot, #ahftjiwpna tr, #ahftjiwpna td, #ahftjiwpna th {
  border-style: none;
}

#ahftjiwpna p {
  margin: 0;
  padding: 0;
}

#ahftjiwpna .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ahftjiwpna .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ahftjiwpna .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ahftjiwpna .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ahftjiwpna .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ahftjiwpna .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ahftjiwpna .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ahftjiwpna .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ahftjiwpna .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ahftjiwpna .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ahftjiwpna .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ahftjiwpna .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ahftjiwpna .gt_spanner_row {
  border-bottom-style: hidden;
}

#ahftjiwpna .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ahftjiwpna .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ahftjiwpna .gt_from_md > :first-child {
  margin-top: 0;
}

#ahftjiwpna .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ahftjiwpna .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ahftjiwpna .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ahftjiwpna .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ahftjiwpna .gt_row_group_first td {
  border-top-width: 2px;
}

#ahftjiwpna .gt_row_group_first th {
  border-top-width: 2px;
}

#ahftjiwpna .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ahftjiwpna .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ahftjiwpna .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ahftjiwpna .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ahftjiwpna .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ahftjiwpna .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ahftjiwpna .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ahftjiwpna .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ahftjiwpna .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ahftjiwpna .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ahftjiwpna .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ahftjiwpna .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ahftjiwpna .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ahftjiwpna .gt_left {
  text-align: left;
}

#ahftjiwpna .gt_center {
  text-align: center;
}

#ahftjiwpna .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ahftjiwpna .gt_font_normal {
  font-weight: normal;
}

#ahftjiwpna .gt_font_bold {
  font-weight: bold;
}

#ahftjiwpna .gt_font_italic {
  font-style: italic;
}

#ahftjiwpna .gt_super {
  font-size: 65%;
}

#ahftjiwpna .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ahftjiwpna .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ahftjiwpna .gt_indent_1 {
  text-indent: 5px;
}

#ahftjiwpna .gt_indent_2 {
  text-indent: 10px;
}

#ahftjiwpna .gt_indent_3 {
  text-indent: 15px;
}

#ahftjiwpna .gt_indent_4 {
  text-indent: 20px;
}

#ahftjiwpna .gt_indent_5 {
  text-indent: 25px;
}

#ahftjiwpna .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ahftjiwpna div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Table&nbsp;1A: ABG cohorts</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Variable</strong></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>No ABG</strong><br>
N = 635,778<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>ABG_NoHypercapnia</strong><br>
N = 137,118<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_3" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>ABG_Hypercapnia</strong><br>
N = 60,580<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">Age (years)</td>
<td class="gt_row gt_center" headers="stat_1">57.1 ± 17.6; 0.0/635,778.0 missing (0.0%)</td>
<td class="gt_row gt_center" headers="stat_2">60.8 ± 17.0; 0.0/137,118.0 missing (0.0%)</td>
<td class="gt_row gt_center" headers="stat_3">62.1 ± 16.3; 0.0/60,580.0 missing (0.0%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Current BMI kg/m2</td>
<td class="gt_row gt_center" headers="stat_1">34.9 ± 8.7; 333,519.0/635,778.0 missing (52.5%)</td>
<td class="gt_row gt_center" headers="stat_2">28.6 ± 6.8; 81,672.0/137,118.0 missing (59.6%)</td>
<td class="gt_row gt_center" headers="stat_3">29.8 ± 7.9; 35,524.0/60,580.0 missing (58.6%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">sex_label</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Female</td>
<td class="gt_row gt_center" headers="stat_1">349,843 (55%)</td>
<td class="gt_row gt_center" headers="stat_2">61,135 (45%)</td>
<td class="gt_row gt_center" headers="stat_3">28,335 (47%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Male</td>
<td class="gt_row gt_center" headers="stat_1">285,935 (45%)</td>
<td class="gt_row gt_center" headers="stat_2">75,983 (55%)</td>
<td class="gt_row gt_center" headers="stat_3">32,245 (53%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">race_ethnicity_label</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;White</td>
<td class="gt_row gt_center" headers="stat_1">389,840 (61%)</td>
<td class="gt_row gt_center" headers="stat_2">85,933 (63%)</td>
<td class="gt_row gt_center" headers="stat_3">41,520 (69%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Black or African American</td>
<td class="gt_row gt_center" headers="stat_1">108,476 (17%)</td>
<td class="gt_row gt_center" headers="stat_2">19,894 (15%)</td>
<td class="gt_row gt_center" headers="stat_3">8,398 (14%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Hispanic</td>
<td class="gt_row gt_center" headers="stat_1">42,986 (6.8%)</td>
<td class="gt_row gt_center" headers="stat_2">7,805 (5.7%)</td>
<td class="gt_row gt_center" headers="stat_3">2,880 (4.8%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Asian</td>
<td class="gt_row gt_center" headers="stat_1">8,404 (1.3%)</td>
<td class="gt_row gt_center" headers="stat_2">2,889 (2.1%)</td>
<td class="gt_row gt_center" headers="stat_3">835 (1.4%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;American Indian</td>
<td class="gt_row gt_center" headers="stat_1">4,503 (0.7%)</td>
<td class="gt_row gt_center" headers="stat_2">1,945 (1.4%)</td>
<td class="gt_row gt_center" headers="stat_3">358 (0.6%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Pacific Islander</td>
<td class="gt_row gt_center" headers="stat_1">968 (0.2%)</td>
<td class="gt_row gt_center" headers="stat_2">166 (0.1%)</td>
<td class="gt_row gt_center" headers="stat_3">58 (&lt;0.1%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_1">80,601 (13%)</td>
<td class="gt_row gt_center" headers="stat_2">18,486 (13%)</td>
<td class="gt_row gt_center" headers="stat_3">6,531 (11%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">location_label</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;South</td>
<td class="gt_row gt_center" headers="stat_1">276,505 (43%)</td>
<td class="gt_row gt_center" headers="stat_2">73,634 (54%)</td>
<td class="gt_row gt_center" headers="stat_3">33,609 (55%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Northeast</td>
<td class="gt_row gt_center" headers="stat_1">159,345 (25%)</td>
<td class="gt_row gt_center" headers="stat_2">24,731 (18%)</td>
<td class="gt_row gt_center" headers="stat_3">13,728 (23%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Midwest</td>
<td class="gt_row gt_center" headers="stat_1">59,926 (9.4%)</td>
<td class="gt_row gt_center" headers="stat_2">11,943 (8.7%)</td>
<td class="gt_row gt_center" headers="stat_3">5,328 (8.8%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;West</td>
<td class="gt_row gt_center" headers="stat_1">140,002 (22%)</td>
<td class="gt_row gt_center" headers="stat_2">26,810 (20%)</td>
<td class="gt_row gt_center" headers="stat_3">7,915 (13%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">osa_label</td>
<td class="gt_row gt_center" headers="stat_1">152,809 (24%)</td>
<td class="gt_row gt_center" headers="stat_2">19,574 (14%)</td>
<td class="gt_row gt_center" headers="stat_3">12,830 (21%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">asthma_label</td>
<td class="gt_row gt_center" headers="stat_1">102,248 (16%)</td>
<td class="gt_row gt_center" headers="stat_2">14,076 (10%)</td>
<td class="gt_row gt_center" headers="stat_3">8,704 (14%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">copd_label</td>
<td class="gt_row gt_center" headers="stat_1">105,391 (17%)</td>
<td class="gt_row gt_center" headers="stat_2">22,798 (17%)</td>
<td class="gt_row gt_center" headers="stat_3">19,790 (33%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">chf_label</td>
<td class="gt_row gt_center" headers="stat_1">100,760 (16%)</td>
<td class="gt_row gt_center" headers="stat_2">27,087 (20%)</td>
<td class="gt_row gt_center" headers="stat_3">17,097 (28%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">nmd_label</td>
<td class="gt_row gt_center" headers="stat_1">25,187 (4.0%)</td>
<td class="gt_row gt_center" headers="stat_2">6,175 (4.5%)</td>
<td class="gt_row gt_center" headers="stat_3">2,601 (4.3%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">phtn_label</td>
<td class="gt_row gt_center" headers="stat_1">40,606 (6.4%)</td>
<td class="gt_row gt_center" headers="stat_2">11,440 (8.3%)</td>
<td class="gt_row gt_center" headers="stat_3">7,878 (13%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">ckd_label</td>
<td class="gt_row gt_center" headers="stat_1">91,830 (14%)</td>
<td class="gt_row gt_center" headers="stat_2">26,117 (19%)</td>
<td class="gt_row gt_center" headers="stat_3">12,331 (20%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">diabetes_label</td>
<td class="gt_row gt_center" headers="stat_1">188,371 (30%)</td>
<td class="gt_row gt_center" headers="stat_2">39,487 (29%)</td>
<td class="gt_row gt_center" headers="stat_3">19,431 (32%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">VBG PCO2</td>
<td class="gt_row gt_center" headers="stat_1">45.5 ± 10.4; 535,921.0/635,778.0 missing (84.3%)</td>
<td class="gt_row gt_center" headers="stat_2">41.9 ± 11.2; 98,287.0/137,118.0 missing (71.7%)</td>
<td class="gt_row gt_center" headers="stat_3">57.3 ± 18.2; 42,801.0/60,580.0 missing (70.7%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Arterial PCO2</td>
<td class="gt_row gt_center" headers="stat_1">NA ± NA; 635,778.0/635,778.0 missing (100.0%)</td>
<td class="gt_row gt_center" headers="stat_2">35.6 ± 6.1; 0.0/137,118.0 missing (0.0%)</td>
<td class="gt_row gt_center" headers="stat_3">58.2 ± 20.0; 0.0/60,580.0 missing (0.0%)</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> Mean ± SD; N Missing/No.&nbsp;obs. missing (% Missing); n (%)</td>
</tr>
</tfoot>

</table>

</div>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>table1B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ntxlqmpzwo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ntxlqmpzwo table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ntxlqmpzwo thead, #ntxlqmpzwo tbody, #ntxlqmpzwo tfoot, #ntxlqmpzwo tr, #ntxlqmpzwo td, #ntxlqmpzwo th {
  border-style: none;
}

#ntxlqmpzwo p {
  margin: 0;
  padding: 0;
}

#ntxlqmpzwo .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ntxlqmpzwo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ntxlqmpzwo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ntxlqmpzwo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ntxlqmpzwo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ntxlqmpzwo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ntxlqmpzwo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ntxlqmpzwo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ntxlqmpzwo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ntxlqmpzwo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ntxlqmpzwo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ntxlqmpzwo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ntxlqmpzwo .gt_spanner_row {
  border-bottom-style: hidden;
}

#ntxlqmpzwo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ntxlqmpzwo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ntxlqmpzwo .gt_from_md > :first-child {
  margin-top: 0;
}

#ntxlqmpzwo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ntxlqmpzwo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ntxlqmpzwo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ntxlqmpzwo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ntxlqmpzwo .gt_row_group_first td {
  border-top-width: 2px;
}

#ntxlqmpzwo .gt_row_group_first th {
  border-top-width: 2px;
}

#ntxlqmpzwo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ntxlqmpzwo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ntxlqmpzwo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ntxlqmpzwo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ntxlqmpzwo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ntxlqmpzwo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ntxlqmpzwo .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ntxlqmpzwo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ntxlqmpzwo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ntxlqmpzwo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ntxlqmpzwo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ntxlqmpzwo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ntxlqmpzwo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ntxlqmpzwo .gt_left {
  text-align: left;
}

#ntxlqmpzwo .gt_center {
  text-align: center;
}

#ntxlqmpzwo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ntxlqmpzwo .gt_font_normal {
  font-weight: normal;
}

#ntxlqmpzwo .gt_font_bold {
  font-weight: bold;
}

#ntxlqmpzwo .gt_font_italic {
  font-style: italic;
}

#ntxlqmpzwo .gt_super {
  font-size: 65%;
}

#ntxlqmpzwo .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ntxlqmpzwo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ntxlqmpzwo .gt_indent_1 {
  text-indent: 5px;
}

#ntxlqmpzwo .gt_indent_2 {
  text-indent: 10px;
}

#ntxlqmpzwo .gt_indent_3 {
  text-indent: 15px;
}

#ntxlqmpzwo .gt_indent_4 {
  text-indent: 20px;
}

#ntxlqmpzwo .gt_indent_5 {
  text-indent: 25px;
}

#ntxlqmpzwo .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ntxlqmpzwo div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Table&nbsp;1B: VBG cohorts</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Variable</strong></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>No VBG</strong><br>
N = 677,009<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>VBG_NoHypercapnia</strong><br>
N = 110,524<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_3" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>VBG_Hypercapnia</strong><br>
N = 45,943<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">Age (years)</td>
<td class="gt_row gt_center" headers="stat_1">57.9 ± 17.5; 0.0/677,009.0 missing (0.0%)</td>
<td class="gt_row gt_center" headers="stat_2">58.0 ± 17.8; 0.0/110,524.0 missing (0.0%)</td>
<td class="gt_row gt_center" headers="stat_3">60.9 ± 16.7; 0.0/45,943.0 missing (0.0%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Current BMI kg/m2</td>
<td class="gt_row gt_center" headers="stat_1">34.4 ± 8.7; 344,231.0/677,009.0 missing (50.8%)</td>
<td class="gt_row gt_center" headers="stat_2">28.7 ± 7.1; 73,719.0/110,524.0 missing (66.7%)</td>
<td class="gt_row gt_center" headers="stat_3">29.3 ± 7.9; 32,765.0/45,943.0 missing (71.3%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">sex_label</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Female</td>
<td class="gt_row gt_center" headers="stat_1">366,682 (54%)</td>
<td class="gt_row gt_center" headers="stat_2">51,350 (46%)</td>
<td class="gt_row gt_center" headers="stat_3">21,281 (46%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Male</td>
<td class="gt_row gt_center" headers="stat_1">310,327 (46%)</td>
<td class="gt_row gt_center" headers="stat_2">59,174 (54%)</td>
<td class="gt_row gt_center" headers="stat_3">24,662 (54%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">race_ethnicity_label</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;White</td>
<td class="gt_row gt_center" headers="stat_1">434,680 (64%)</td>
<td class="gt_row gt_center" headers="stat_2">56,806 (51%)</td>
<td class="gt_row gt_center" headers="stat_3">25,807 (56%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Black or African American</td>
<td class="gt_row gt_center" headers="stat_1">108,566 (16%)</td>
<td class="gt_row gt_center" headers="stat_2">19,433 (18%)</td>
<td class="gt_row gt_center" headers="stat_3">8,769 (19%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Hispanic</td>
<td class="gt_row gt_center" headers="stat_1">42,507 (6.3%)</td>
<td class="gt_row gt_center" headers="stat_2">8,609 (7.8%)</td>
<td class="gt_row gt_center" headers="stat_3">2,555 (5.6%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Asian</td>
<td class="gt_row gt_center" headers="stat_1">8,992 (1.3%)</td>
<td class="gt_row gt_center" headers="stat_2">2,420 (2.2%)</td>
<td class="gt_row gt_center" headers="stat_3">716 (1.6%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;American Indian</td>
<td class="gt_row gt_center" headers="stat_1">4,701 (0.7%)</td>
<td class="gt_row gt_center" headers="stat_2">1,839 (1.7%)</td>
<td class="gt_row gt_center" headers="stat_3">266 (0.6%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Pacific Islander</td>
<td class="gt_row gt_center" headers="stat_1">1,051 (0.2%)</td>
<td class="gt_row gt_center" headers="stat_2">112 (0.1%)</td>
<td class="gt_row gt_center" headers="stat_3">29 (&lt;0.1%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_1">76,512 (11%)</td>
<td class="gt_row gt_center" headers="stat_2">21,305 (19%)</td>
<td class="gt_row gt_center" headers="stat_3">7,801 (17%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">location_label</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;South</td>
<td class="gt_row gt_center" headers="stat_1">338,056 (50%)</td>
<td class="gt_row gt_center" headers="stat_2">30,555 (28%)</td>
<td class="gt_row gt_center" headers="stat_3">15,137 (33%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Northeast</td>
<td class="gt_row gt_center" headers="stat_1">129,850 (19%)</td>
<td class="gt_row gt_center" headers="stat_2">47,118 (43%)</td>
<td class="gt_row gt_center" headers="stat_3">20,836 (45%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Midwest</td>
<td class="gt_row gt_center" headers="stat_1">62,803 (9.3%)</td>
<td class="gt_row gt_center" headers="stat_2">9,723 (8.8%)</td>
<td class="gt_row gt_center" headers="stat_3">4,671 (10%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;West</td>
<td class="gt_row gt_center" headers="stat_1">146,300 (22%)</td>
<td class="gt_row gt_center" headers="stat_2">23,128 (21%)</td>
<td class="gt_row gt_center" headers="stat_3">5,299 (12%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">osa_label</td>
<td class="gt_row gt_center" headers="stat_1">159,156 (24%)</td>
<td class="gt_row gt_center" headers="stat_2">16,627 (15%)</td>
<td class="gt_row gt_center" headers="stat_3">9,430 (21%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">asthma_label</td>
<td class="gt_row gt_center" headers="stat_1">103,907 (15%)</td>
<td class="gt_row gt_center" headers="stat_2">14,188 (13%)</td>
<td class="gt_row gt_center" headers="stat_3">6,933 (15%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">copd_label</td>
<td class="gt_row gt_center" headers="stat_1">117,454 (17%)</td>
<td class="gt_row gt_center" headers="stat_2">17,165 (16%)</td>
<td class="gt_row gt_center" headers="stat_3">13,360 (29%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">chf_label</td>
<td class="gt_row gt_center" headers="stat_1">110,887 (16%)</td>
<td class="gt_row gt_center" headers="stat_2">21,574 (20%)</td>
<td class="gt_row gt_center" headers="stat_3">12,483 (27%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">nmd_label</td>
<td class="gt_row gt_center" headers="stat_1">28,289 (4.2%)</td>
<td class="gt_row gt_center" headers="stat_2">3,906 (3.5%)</td>
<td class="gt_row gt_center" headers="stat_3">1,768 (3.8%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">phtn_label</td>
<td class="gt_row gt_center" headers="stat_1">45,122 (6.7%)</td>
<td class="gt_row gt_center" headers="stat_2">9,048 (8.2%)</td>
<td class="gt_row gt_center" headers="stat_3">5,754 (13%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">ckd_label</td>
<td class="gt_row gt_center" headers="stat_1">98,631 (15%)</td>
<td class="gt_row gt_center" headers="stat_2">22,407 (20%)</td>
<td class="gt_row gt_center" headers="stat_3">9,240 (20%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">diabetes_label</td>
<td class="gt_row gt_center" headers="stat_1">197,317 (29%)</td>
<td class="gt_row gt_center" headers="stat_2">35,204 (32%)</td>
<td class="gt_row gt_center" headers="stat_3">14,768 (32%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">VBG PCO2</td>
<td class="gt_row gt_center" headers="stat_1">NA ± NA; 677,009.0/677,009.0 missing (100.0%)</td>
<td class="gt_row gt_center" headers="stat_2">40.1 ± 6.5; 0.0/110,524.0 missing (0.0%)</td>
<td class="gt_row gt_center" headers="stat_3">60.0 ± 12.4; 0.0/45,943.0 missing (0.0%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">Arterial PCO2</td>
<td class="gt_row gt_center" headers="stat_1">42.3 ± 15.2; 535,921.0/677,009.0 missing (79.2%)</td>
<td class="gt_row gt_center" headers="stat_2">38.5 ± 15.2; 71,896.0/110,524.0 missing (65.1%)</td>
<td class="gt_row gt_center" headers="stat_3">52.7 ± 19.5; 27,961.0/45,943.0 missing (60.9%)</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="4" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> Mean ± SD; N Missing/No.&nbsp;obs. missing (% Missing); n (%)</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>Generating Word Doc for Table 1A &amp; 1B</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>ft_table1A <span class="ot">&lt;-</span> <span class="fu">as_flex_table</span>(table1A)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>ft_table1B <span class="ot">&lt;-</span> <span class="fu">as_flex_table</span>(table1B)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>doc <span class="ot">&lt;-</span> <span class="fu">read_docx</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">body_add_par</span>(<span class="st">"Table 1A. Baseline Characteristics by ABG Group"</span>, <span class="at">style =</span> <span class="st">"heading 1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">body_add_flextable</span>(ft_table1A) <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">body_add_par</span>(<span class="st">"Table 1B. Baseline Characteristics by VBG Group"</span>, <span class="at">style =</span> <span class="st">"heading 1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">body_add_flextable</span>(ft_table1B)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(doc, <span class="at">target =</span> <span class="st">"Table1_ABG_VBG.docx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Unweighted, Hypercapnia (binary yes/no) Simple (1 predictor) Regressions:</strong></p>
<p>Unweighted, ABG Group: hypercapnia treated as a binary (yes/no) predictor</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>logit_intubated_abg <span class="ot">&lt;-</span> <span class="fu">glm</span>(imv_proc <span class="sc">~</span> hypercap_on_abg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_intubated_abg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = imv_proc ~ hypercap_on_abg, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -2.836415   0.004973  -570.4   &lt;2e-16 ***
hypercap_on_abg  1.762130   0.010569   166.7   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 422228  on 833475  degrees of freedom
Residual deviance: 399665  on 833474  degrees of freedom
AIC: 399669

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_intubated_abg,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term            estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0.0586   0.00497     -570.       0   0.0581    0.0592
2 hypercap_on_abg   5.82     0.0106       167.       0   5.71      5.95  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>logit_niv_abg <span class="ot">&lt;-</span> <span class="fu">glm</span>(niv_proc <span class="sc">~</span> hypercap_on_abg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_niv_abg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = niv_proc ~ hypercap_on_abg, family = binomial, 
    data = subset_data)

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -3.40531    0.00645  -527.9   &lt;2e-16 ***
hypercap_on_abg  1.69268    0.01300   130.2   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 284717  on 833475  degrees of freedom
Residual deviance: 271415  on 833474  degrees of freedom
AIC: 271419

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_niv_abg,</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term            estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0.0332   0.00645     -528.       0   0.0328    0.0336
2 hypercap_on_abg   5.43     0.0130       130.       0   5.30      5.57  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>logit_death_abg <span class="ot">&lt;-</span> <span class="fu">glm</span>(death_60d <span class="sc">~</span> hypercap_on_abg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_death_abg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = death_60d ~ hypercap_on_abg, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -2.737939   0.004761  -575.1   &lt;2e-16 ***
hypercap_on_abg  1.195267   0.011680   102.3   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 419161  on 833475  degrees of freedom
Residual deviance: 410518  on 833474  degrees of freedom
AIC: 410522

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_death_abg,</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term            estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0.0647   0.00476     -575.       0   0.0641    0.0653
2 hypercap_on_abg   3.30     0.0117       102.       0   3.23      3.38  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>logit_icd_abg <span class="ot">&lt;-</span> <span class="fu">glm</span>(hypercap_resp_failure <span class="sc">~</span> hypercap_on_abg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_icd_abg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = hypercap_resp_failure ~ hypercap_on_abg, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -3.812280   0.007821  -487.5   &lt;2e-16 ***
hypercap_on_abg  2.587547   0.012458   207.7   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 261441  on 833475  degrees of freedom
Residual deviance: 226105  on 833474  degrees of freedom
AIC: 226109

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_icd_abg,</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term            estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0.0221   0.00782     -487.       0   0.0218    0.0224
2 hypercap_on_abg  13.3      0.0125       208.       0  13.0      13.6   </code></pre>
</div>
</div>
<p>Display the regression coefficients for the binary (hypercapnia yes/no) predictor logistic regressions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"Intubated"</span> <span class="ot">=</span> logit_intubated_abg,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">"NIV"</span>       <span class="ot">=</span> logit_niv_abg,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Death"</span>     <span class="ot">=</span> logit_death_abg,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"ICD Hyper"</span> <span class="ot">=</span> logit_icd_abg),</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf_level   =</span> <span class="fl">0.95</span>,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate     =</span> <span class="st">"{estimate}"</span>,</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic    =</span> <span class="st">"({conf.low}, {conf.high})"</span>,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_omit    =</span> <span class="st">"(Intercept)"</span>,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit     =</span> <span class="st">".*"</span>,                      <span class="co"># drop all goodness-of-fit rows</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt          =</span> <span class="dv">2</span>,                         <span class="co"># 2 decimal places everywhere</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">output       =</span> <span class="st">"gt"</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Odds Ratios for ABG Hypercapnia (&gt;45 mmHg)'s association with..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="hzmvdwdxly" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hzmvdwdxly table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hzmvdwdxly thead, #hzmvdwdxly tbody, #hzmvdwdxly tfoot, #hzmvdwdxly tr, #hzmvdwdxly td, #hzmvdwdxly th {
  border-style: none;
}

#hzmvdwdxly p {
  margin: 0;
  padding: 0;
}

#hzmvdwdxly .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hzmvdwdxly .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hzmvdwdxly .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hzmvdwdxly .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hzmvdwdxly .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hzmvdwdxly .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzmvdwdxly .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hzmvdwdxly .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hzmvdwdxly .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hzmvdwdxly .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hzmvdwdxly .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hzmvdwdxly .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hzmvdwdxly .gt_spanner_row {
  border-bottom-style: hidden;
}

#hzmvdwdxly .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hzmvdwdxly .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hzmvdwdxly .gt_from_md > :first-child {
  margin-top: 0;
}

#hzmvdwdxly .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hzmvdwdxly .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hzmvdwdxly .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hzmvdwdxly .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hzmvdwdxly .gt_row_group_first td {
  border-top-width: 2px;
}

#hzmvdwdxly .gt_row_group_first th {
  border-top-width: 2px;
}

#hzmvdwdxly .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzmvdwdxly .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hzmvdwdxly .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hzmvdwdxly .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzmvdwdxly .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzmvdwdxly .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hzmvdwdxly .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hzmvdwdxly .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hzmvdwdxly .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzmvdwdxly .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hzmvdwdxly .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzmvdwdxly .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hzmvdwdxly .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzmvdwdxly .gt_left {
  text-align: left;
}

#hzmvdwdxly .gt_center {
  text-align: center;
}

#hzmvdwdxly .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hzmvdwdxly .gt_font_normal {
  font-weight: normal;
}

#hzmvdwdxly .gt_font_bold {
  font-weight: bold;
}

#hzmvdwdxly .gt_font_italic {
  font-style: italic;
}

#hzmvdwdxly .gt_super {
  font-size: 65%;
}

#hzmvdwdxly .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hzmvdwdxly .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hzmvdwdxly .gt_indent_1 {
  text-indent: 5px;
}

#hzmvdwdxly .gt_indent_2 {
  text-indent: 10px;
}

#hzmvdwdxly .gt_indent_3 {
  text-indent: 15px;
}

#hzmvdwdxly .gt_indent_4 {
  text-indent: 20px;
}

#hzmvdwdxly .gt_indent_5 {
  text-indent: 25px;
}

#hzmvdwdxly .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hzmvdwdxly div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border">Odds Ratios for ABG Hypercapnia (&gt;45 mmHg)'s association with...</th>
</tr>
<tr class="gt_col_headings even">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Intubated" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Intubated</th>
<th id="NIV" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">NIV</th>
<th id="Death" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Death</th>
<th id="ICD-Hyper" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">ICD Hyper</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hypercap_on_abg</td>
<td class="gt_row gt_center" headers="Intubated">5.82</td>
<td class="gt_row gt_center" headers="NIV">5.43</td>
<td class="gt_row gt_center" headers="Death">3.30</td>
<td class="gt_row gt_center" headers="ICD Hyper">13.30</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="Intubated">(5.71, 5.95)</td>
<td class="gt_row gt_center" headers="NIV">(5.30, 5.57)</td>
<td class="gt_row gt_center" headers="Death">(3.23, 3.38)</td>
<td class="gt_row gt_center" headers="ICD Hyper">(12.98, 13.63)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Unweighted VBG Group</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>logit_intubated_vbg <span class="ot">&lt;-</span> <span class="fu">glm</span>(imv_proc <span class="sc">~</span> hypercap_on_vbg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_intubated_vbg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = imv_proc ~ hypercap_on_vbg, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -2.689261   0.004617 -582.45   &lt;2e-16 ***
hypercap_on_vbg  1.153215   0.013064   88.28   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 422228  on 833475  degrees of freedom
Residual deviance: 415865  on 833474  degrees of freedom
AIC: 415869

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_intubated_vbg,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term            estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0.0679   0.00462    -582.        0   0.0673    0.0685
2 hypercap_on_vbg   3.17     0.0131       88.3       0   3.09      3.25  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>logit_niv_vbg <span class="ot">&lt;-</span> <span class="fu">glm</span>(niv_proc <span class="sc">~</span> hypercap_on_vbg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_niv_vbg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = niv_proc ~ hypercap_on_vbg, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -3.272248   0.006006 -544.83   &lt;2e-16 ***
hypercap_on_vbg  1.238962   0.015771   78.56   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 284717  on 833475  degrees of freedom
Residual deviance: 279858  on 833474  degrees of freedom
AIC: 279862

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_niv_vbg,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term            estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0.0379   0.00601    -545.        0   0.0375    0.0384
2 hypercap_on_vbg   3.45     0.0158       78.6       0   3.35      3.56  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>logit_death_vbg <span class="ot">&lt;-</span> <span class="fu">glm</span>(death_60d <span class="sc">~</span> hypercap_on_vbg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_death_vbg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = death_60d ~ hypercap_on_vbg, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -2.672668   0.004584 -583.06   &lt;2e-16 ***
hypercap_on_vbg  0.915795   0.013943   65.68   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 419161  on 833475  degrees of freedom
Residual deviance: 415548  on 833474  degrees of freedom
AIC: 415552

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_death_vbg,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term            estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0.0691   0.00458    -583.        0   0.0684    0.0697
2 hypercap_on_vbg   2.50     0.0139       65.7       0   2.43      2.57  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>logit_icd_vbg <span class="ot">&lt;-</span> <span class="fu">glm</span>(hypercap_resp_failure <span class="sc">~</span> hypercap_on_vbg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_icd_vbg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = hypercap_resp_failure ~ hypercap_on_vbg, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -3.597992   0.006997  -514.2   &lt;2e-16 ***
hypercap_on_vbg  2.251011   0.013485   166.9   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 261441  on 833475  degrees of freedom
Residual deviance: 240345  on 833474  degrees of freedom
AIC: 240349

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_icd_vbg,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term            estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)       0.0274   0.00700     -514.       0   0.0270    0.0278
2 hypercap_on_vbg   9.50     0.0135       167.       0   9.25      9.75  </code></pre>
</div>
</div>
<p>Display model coefficients for binary hypercapnia on VBG logistic regression</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"Intubated"</span> <span class="ot">=</span> logit_intubated_vbg,</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">"NIV"</span>       <span class="ot">=</span> logit_niv_vbg,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Death"</span>     <span class="ot">=</span> logit_death_vbg,</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"ICD Hyper"</span> <span class="ot">=</span> logit_icd_vbg),</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf_level   =</span> <span class="fl">0.95</span>,</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate     =</span> <span class="st">"{estimate}"</span>,</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic    =</span> <span class="st">"({conf.low}, {conf.high})"</span>,</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_omit    =</span> <span class="st">"(Intercept)"</span>,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit     =</span> <span class="st">".*"</span>,                      <span class="co"># drop all goodness-of-fit rows</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt          =</span> <span class="dv">2</span>,                         <span class="co"># 2 decimal places everywhere</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">output       =</span> <span class="st">"gt"</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Odds Ratios for VBG Hypercapnia (&gt;45 mmHg)'s association with..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tnbvjbcmin" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#tnbvjbcmin table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#tnbvjbcmin thead, #tnbvjbcmin tbody, #tnbvjbcmin tfoot, #tnbvjbcmin tr, #tnbvjbcmin td, #tnbvjbcmin th {
  border-style: none;
}

#tnbvjbcmin p {
  margin: 0;
  padding: 0;
}

#tnbvjbcmin .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tnbvjbcmin .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#tnbvjbcmin .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tnbvjbcmin .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tnbvjbcmin .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tnbvjbcmin .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tnbvjbcmin .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tnbvjbcmin .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tnbvjbcmin .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tnbvjbcmin .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tnbvjbcmin .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tnbvjbcmin .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tnbvjbcmin .gt_spanner_row {
  border-bottom-style: hidden;
}

#tnbvjbcmin .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#tnbvjbcmin .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tnbvjbcmin .gt_from_md > :first-child {
  margin-top: 0;
}

#tnbvjbcmin .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tnbvjbcmin .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tnbvjbcmin .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tnbvjbcmin .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tnbvjbcmin .gt_row_group_first td {
  border-top-width: 2px;
}

#tnbvjbcmin .gt_row_group_first th {
  border-top-width: 2px;
}

#tnbvjbcmin .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tnbvjbcmin .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tnbvjbcmin .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tnbvjbcmin .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tnbvjbcmin .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tnbvjbcmin .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tnbvjbcmin .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#tnbvjbcmin .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tnbvjbcmin .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tnbvjbcmin .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tnbvjbcmin .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tnbvjbcmin .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tnbvjbcmin .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tnbvjbcmin .gt_left {
  text-align: left;
}

#tnbvjbcmin .gt_center {
  text-align: center;
}

#tnbvjbcmin .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tnbvjbcmin .gt_font_normal {
  font-weight: normal;
}

#tnbvjbcmin .gt_font_bold {
  font-weight: bold;
}

#tnbvjbcmin .gt_font_italic {
  font-style: italic;
}

#tnbvjbcmin .gt_super {
  font-size: 65%;
}

#tnbvjbcmin .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#tnbvjbcmin .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tnbvjbcmin .gt_indent_1 {
  text-indent: 5px;
}

#tnbvjbcmin .gt_indent_2 {
  text-indent: 10px;
}

#tnbvjbcmin .gt_indent_3 {
  text-indent: 15px;
}

#tnbvjbcmin .gt_indent_4 {
  text-indent: 20px;
}

#tnbvjbcmin .gt_indent_5 {
  text-indent: 25px;
}

#tnbvjbcmin .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#tnbvjbcmin div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border">Odds Ratios for VBG Hypercapnia (&gt;45 mmHg)'s association with...</th>
</tr>
<tr class="gt_col_headings even">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Intubated" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Intubated</th>
<th id="NIV" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">NIV</th>
<th id="Death" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Death</th>
<th id="ICD-Hyper" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">ICD Hyper</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hypercap_on_vbg</td>
<td class="gt_row gt_center" headers="Intubated">3.17</td>
<td class="gt_row gt_center" headers="NIV">3.45</td>
<td class="gt_row gt_center" headers="Death">2.50</td>
<td class="gt_row gt_center" headers="ICD Hyper">9.50</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="Intubated">(3.09, 3.25)</td>
<td class="gt_row gt_center" headers="NIV">(3.35, 3.56)</td>
<td class="gt_row gt_center" headers="Death">(2.43, 2.57)</td>
<td class="gt_row gt_center" headers="ICD Hyper">(9.25, 9.75)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Calculated ABG from VBG Using Farkas equation - binary predictor</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">calc_abg =</span> vbg_co2 <span class="sc">-</span> (<span class="fl">0.22</span> <span class="sc">*</span> (<span class="dv">93</span> <span class="sc">-</span> vbg_o2sat))</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hypercapnia_calc =</span> <span class="fu">ifelse</span>(calc_abg <span class="sc">&gt;</span> <span class="dv">45</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(subset_data, <span class="fu">table</span>(hypercapnia_calc,niv_proc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                niv_proc
hypercapnia_calc     0     1
               0 48319  2878
               1 14454  2600</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>logit_intubated_calc <span class="ot">&lt;-</span> <span class="fu">glm</span>(imv_proc <span class="sc">~</span> hypercapnia_calc, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_intubated_calc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = imv_proc ~ hypercapnia_calc, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)      -1.96944    0.01348 -146.08   &lt;2e-16 ***
hypercapnia_calc  0.53148    0.02366   22.46   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 55227  on 68250  degrees of freedom
Residual deviance: 54743  on 68249  degrees of freedom
  (765225 observations deleted due to missingness)
AIC: 54747

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_intubated_calc,</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term             estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)         0.140    0.0135    -146.  0            0.136     0.143
2 hypercapnia_calc    1.70     0.0237      22.5 1.02e-111    1.62      1.78 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>logit_niv_calc <span class="ot">&lt;-</span> <span class="fu">glm</span>(niv_proc <span class="sc">~</span> hypercapnia_calc, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_niv_calc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = niv_proc ~ hypercapnia_calc, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)      -2.82073    0.01919 -147.01   &lt;2e-16 ***
hypercapnia_calc  1.10527    0.02867   38.55   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 38140  on 68250  degrees of freedom
Residual deviance: 36723  on 68249  degrees of freedom
  (765225 observations deleted due to missingness)
AIC: 36727

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_niv_calc,</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term             estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)        0.0596    0.0192    -147.        0   0.0574    0.0618
2 hypercapnia_calc   3.02      0.0287      38.6       0   2.85      3.19  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>logit_death_calc <span class="ot">&lt;-</span> <span class="fu">glm</span>(death_60d <span class="sc">~</span> hypercapnia_calc, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_death_calc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = death_60d ~ hypercapnia_calc, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)      -1.79845    0.01266 -142.06  &lt; 2e-16 ***
hypercapnia_calc  0.15643    0.02433    6.43 1.27e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 57003  on 68250  degrees of freedom
Residual deviance: 56963  on 68249  degrees of freedom
  (765225 observations deleted due to missingness)
AIC: 56967

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_death_calc,</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term             estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)         0.166    0.0127   -142.   0           0.161     0.170
2 hypercapnia_calc    1.17     0.0243      6.43 1.27e-10    1.11      1.23 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>logit_icd_calc <span class="ot">&lt;-</span> <span class="fu">glm</span>(hypercap_resp_failure <span class="sc">~</span> hypercapnia_calc, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_icd_calc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = hypercap_resp_failure ~ hypercapnia_calc, family = binomial, 
    data = subset_data)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)      -3.18924    0.02267 -140.68   &lt;2e-16 ***
hypercapnia_calc  2.23162    0.02840   78.58   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 44070  on 68250  degrees of freedom
Residual deviance: 37196  on 68249  degrees of freedom
  (765225 observations deleted due to missingness)
AIC: 37200

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logit_icd_calc,</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,   <span class="co"># turns log-odds → OR</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf.int     =</span> <span class="cn">TRUE</span>)   <span class="co"># adds 95 % CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term             estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)        0.0412    0.0227    -141.        0   0.0394    0.0431
2 hypercapnia_calc   9.31      0.0284      78.6       0   8.81      9.85  </code></pre>
</div>
</div>
<p>Display regression coefficients for binary Farkas adjustment (hypercapnia yes/no as predictor)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"Intubated"</span> <span class="ot">=</span> logit_intubated_calc,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">"NIV"</span>       <span class="ot">=</span> logit_niv_calc,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Death"</span>     <span class="ot">=</span> logit_death_calc,</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">"ICD Hyper"</span> <span class="ot">=</span> logit_icd_calc),</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">exponentiate =</span> <span class="cn">TRUE</span>,</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf_level   =</span> <span class="fl">0.95</span>,</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimate     =</span> <span class="st">"{estimate}"</span>,</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic    =</span> <span class="st">"({conf.low}, {conf.high})"</span>,</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_omit    =</span> <span class="st">"(Intercept)"</span>,</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit     =</span> <span class="st">".*"</span>,                      <span class="co"># drop all goodness-of-fit rows</span></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt          =</span> <span class="dv">2</span>,                         <span class="co"># 2 decimal places everywhere</span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">output       =</span> <span class="st">"gt"</span></span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Odds Ratios for Calculated Hypercapnia (&gt;45 mmHg)'s association with..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="lrjedvwhmc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lrjedvwhmc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lrjedvwhmc thead, #lrjedvwhmc tbody, #lrjedvwhmc tfoot, #lrjedvwhmc tr, #lrjedvwhmc td, #lrjedvwhmc th {
  border-style: none;
}

#lrjedvwhmc p {
  margin: 0;
  padding: 0;
}

#lrjedvwhmc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lrjedvwhmc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lrjedvwhmc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lrjedvwhmc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lrjedvwhmc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lrjedvwhmc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lrjedvwhmc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lrjedvwhmc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lrjedvwhmc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lrjedvwhmc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lrjedvwhmc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lrjedvwhmc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lrjedvwhmc .gt_spanner_row {
  border-bottom-style: hidden;
}

#lrjedvwhmc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lrjedvwhmc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lrjedvwhmc .gt_from_md > :first-child {
  margin-top: 0;
}

#lrjedvwhmc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lrjedvwhmc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lrjedvwhmc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lrjedvwhmc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lrjedvwhmc .gt_row_group_first td {
  border-top-width: 2px;
}

#lrjedvwhmc .gt_row_group_first th {
  border-top-width: 2px;
}

#lrjedvwhmc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lrjedvwhmc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lrjedvwhmc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lrjedvwhmc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lrjedvwhmc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lrjedvwhmc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lrjedvwhmc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lrjedvwhmc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lrjedvwhmc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lrjedvwhmc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lrjedvwhmc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lrjedvwhmc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lrjedvwhmc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lrjedvwhmc .gt_left {
  text-align: left;
}

#lrjedvwhmc .gt_center {
  text-align: center;
}

#lrjedvwhmc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lrjedvwhmc .gt_font_normal {
  font-weight: normal;
}

#lrjedvwhmc .gt_font_bold {
  font-weight: bold;
}

#lrjedvwhmc .gt_font_italic {
  font-style: italic;
}

#lrjedvwhmc .gt_super {
  font-size: 65%;
}

#lrjedvwhmc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lrjedvwhmc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lrjedvwhmc .gt_indent_1 {
  text-indent: 5px;
}

#lrjedvwhmc .gt_indent_2 {
  text-indent: 10px;
}

#lrjedvwhmc .gt_indent_3 {
  text-indent: 15px;
}

#lrjedvwhmc .gt_indent_4 {
  text-indent: 20px;
}

#lrjedvwhmc .gt_indent_5 {
  text-indent: 25px;
}

#lrjedvwhmc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#lrjedvwhmc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border">Odds Ratios for Calculated Hypercapnia (&gt;45 mmHg)'s association with...</th>
</tr>
<tr class="gt_col_headings even">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Intubated" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Intubated</th>
<th id="NIV" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">NIV</th>
<th id="Death" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Death</th>
<th id="ICD-Hyper" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">ICD Hyper</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hypercapnia_calc</td>
<td class="gt_row gt_center" headers="Intubated">1.70</td>
<td class="gt_row gt_center" headers="NIV">3.02</td>
<td class="gt_row gt_center" headers="Death">1.17</td>
<td class="gt_row gt_center" headers="ICD Hyper">9.31</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="Intubated">(1.62, 1.78)</td>
<td class="gt_row gt_center" headers="NIV">(2.85, 3.19)</td>
<td class="gt_row gt_center" headers="Death">(1.11, 1.23)</td>
<td class="gt_row gt_center" headers="ICD Hyper">(8.81, 9.85)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Odds Ratio Graph of all 3 simple, binary-predictor logistic regressions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>tidy_with_labels <span class="ot">&lt;-</span> <span class="cf">function</span>(model, group_label, outcome_label) {</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(model, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"hypercap_on_abg"</span> <span class="sc">|</span> term <span class="sc">==</span> <span class="st">"hypercap_on_vbg"</span> <span class="sc">|</span> term <span class="sc">==</span> <span class="st">"hypercapnia_calc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> group_label,</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">outcome =</span> outcome_label</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ABG Models ---</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>abg_intub <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(imv_proc <span class="sc">~</span> hypercap_on_abg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"ABG"</span>, <span class="st">"Intubation"</span>)</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>abg_niv   <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(niv_proc <span class="sc">~</span> hypercap_on_abg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"ABG"</span>, <span class="st">"NIV"</span>)</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>abg_death <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(death_60d <span class="sc">~</span> hypercap_on_abg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"ABG"</span>, <span class="st">"Death"</span>)</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>abg_icd   <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(hypercap_resp_failure <span class="sc">~</span> hypercap_on_abg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"ABG"</span>, <span class="st">"ICD Code"</span>)</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a><span class="co"># --- VBG Models ---</span></span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>vbg_intub <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(imv_proc <span class="sc">~</span> hypercap_on_vbg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"VBG"</span>, <span class="st">"Intubation"</span>)</span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>vbg_niv   <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(niv_proc <span class="sc">~</span> hypercap_on_vbg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"VBG"</span>, <span class="st">"NIV"</span>)</span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>vbg_death <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(death_60d <span class="sc">~</span> hypercap_on_vbg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"VBG"</span>, <span class="st">"Death"</span>)</span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>vbg_icd   <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(hypercap_resp_failure <span class="sc">~</span> hypercap_on_vbg, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"VBG"</span>, <span class="st">"ICD Code"</span>)</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Calculated ABG Models ---</span></span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>calc_intub <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(imv_proc <span class="sc">~</span> hypercapnia_calc, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"Calculated ABG"</span>, <span class="st">"Intubation"</span>)</span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>calc_niv   <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(niv_proc <span class="sc">~</span> hypercapnia_calc, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"Calculated ABG"</span>, <span class="st">"NIV"</span>)</span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>calc_death <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(death_60d <span class="sc">~</span> hypercapnia_calc, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"Calculated ABG"</span>, <span class="st">"Death"</span>)</span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>calc_icd   <span class="ot">&lt;-</span> <span class="fu">tidy_with_labels</span>(<span class="fu">glm</span>(hypercap_resp_failure <span class="sc">~</span> hypercapnia_calc, <span class="at">data =</span> subset_data, <span class="at">family =</span> binomial), <span class="st">"Calculated ABG"</span>, <span class="st">"ICD Code"</span>)</span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Combine all model results ---</span></span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a>combined_or_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a>  abg_intub, abg_niv, abg_death, abg_icd,</span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>  vbg_intub, vbg_niv, vbg_death, vbg_icd,</span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a>  calc_intub, calc_niv, calc_death, calc_icd</span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>BL 7/16/2025</strong> - Note<u>: new version below</u>. For this, I changed the title, made the x-axis logarithmic (always logarithmic scale when the variable is a ratio, like an odds ratio or risk ratio), and added the clarification about denominators.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_or_df, <span class="fu">aes</span>(<span class="at">x =</span> outcome, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high, <span class="at">color =</span> group)) <span class="sc">+</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Unweighted, Unadjusted OR of Outcomes when Hypercapnia Present ABG, VBG, Farkas-VBG "</span>,</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Outcome"</span>,</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Odds Ratio (95% CI)"</span>,</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Group"</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">15</span>)) <span class="sc">+</span>  <span class="co"># optional log scale for better spacing</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in transform$transform(limits): NaNs produced</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>combined_or_df<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(combined_or_df<span class="sc">$</span>group,</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ABG"</span>, <span class="st">"VBG"</span>, <span class="st">"Calculated ABG"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ── prerequisites ───────────────────────────────────────────────────────────────</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="co"># order groups before plotting</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>combined_or_df<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  combined_or_df<span class="sc">$</span>group,</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ABG"</span>, <span class="st">"VBG"</span>, <span class="st">"Calculated ABG"</span>)</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ── plot ────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>  combined_or_df,</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x      =</span> outcome,</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y      =</span> estimate,</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin   =</span> conf.low,</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax   =</span> conf.high,</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">color  =</span> group</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.6</span>),</span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">size     =</span> <span class="fl">0.6</span></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## </span><span class="al">NOTE</span><span class="do">:  scale_y_log10 applies to the axis that *becomes horizontal* after coord_flip()</span></span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(</span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>),</span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="dv">16</span>),</span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb127-33"><a href="#cb127-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title  =</span> <span class="st">"Odds Ratio of Outcomes When Hypercapnia Present (ABG, VBG, Calc‑ABG)"</span>,</span>
<span id="cb127-34"><a href="#cb127-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">x      =</span> <span class="st">"Outcome"</span>,</span>
<span id="cb127-35"><a href="#cb127-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y      =</span> <span class="st">"Odds Ratio (log scale, 95 %&nbsp;CI)"</span>,</span>
<span id="cb127-36"><a href="#cb127-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">color  =</span> <span class="st">"Blood‑gas type"</span>,</span>
<span id="cb127-37"><a href="#cb127-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste</span>(</span>
<span id="cb127-38"><a href="#cb127-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Odds ratios are computed *within* each blood‑gas cohort."</span>,</span>
<span id="cb127-39"><a href="#cb127-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Numerator&nbsp;= patients who received that blood‑gas and **had** hypercapnia;"</span>,</span>
<span id="cb127-40"><a href="#cb127-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">"denominator&nbsp;= patients who received the same blood‑gas and **did not** have hypercapnia."</span>,</span>
<span id="cb127-41"><a href="#cb127-41" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Because the underlying cohorts differ (ABG, VBG, Calculated&nbsp;ABG),"</span>,</span>
<span id="cb127-42"><a href="#cb127-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">"denominators are not identical across groups."</span>,</span>
<span id="cb127-43"><a href="#cb127-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb127-44"><a href="#cb127-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb127-45"><a href="#cb127-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb127-46"><a href="#cb127-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb127-47"><a href="#cb127-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now doing 3 groups instead of binary (above, normal and below)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">pco2_cat_abg =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(paco2) <span class="sc">&amp;</span> paco2 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">"Below normal"</span>,</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(paco2) <span class="sc">&amp;</span> paco2 <span class="sc">&gt;</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">"Above normal"</span>,</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(paco2)              <span class="sc">~</span> <span class="st">"Normal"</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pco2_cat_vbg =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(vbg_co2) <span class="sc">&amp;</span> vbg_co2 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">"Below normal"</span>,</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(vbg_co2) <span class="sc">&amp;</span> vbg_co2 <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"Above normal"</span>,</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(vbg_co2)                <span class="sc">~</span> <span class="st">"Normal"</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pco2_cat_calc =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(calc_abg) <span class="sc">&amp;</span> calc_abg <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">"Below normal"</span>,</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(calc_abg) <span class="sc">&amp;</span> calc_abg <span class="sc">&gt;</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">"Above normal"</span>,</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(calc_abg)                 <span class="sc">~</span> <span class="st">"Normal"</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"pco2_cat"</span>),</span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span><span class="fu">factor</span>(.x, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Normal"</span>, <span class="st">"Below normal"</span>, <span class="st">"Above normal"</span>)))</span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>run_logit <span class="ot">&lt;-</span> <span class="cf">function</span>(data, outcome, exposure, group_name) {</span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(outcome, <span class="st">"~"</span>, exposure))</span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(f, <span class="at">data =</span> data, <span class="at">family =</span> binomial) <span class="sc">%&gt;%</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">outcome =</span> outcome,</span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">group   =</span> group_name</span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"imv_proc"</span>, <span class="st">"niv_proc"</span>, <span class="st">"death_60d"</span>, <span class="st">"hypercap_resp_failure"</span>)</span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(outcomes, <span class="cf">function</span>(o) <span class="fu">run_logit</span>(subset_data, o, <span class="st">"pco2_cat_abg"</span>, <span class="st">"ABG"</span>)),</span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(outcomes, <span class="cf">function</span>(o) <span class="fu">run_logit</span>(subset_data, o, <span class="st">"pco2_cat_vbg"</span>, <span class="st">"VBG"</span>)),</span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(outcomes, <span class="cf">function</span>(o) <span class="fu">run_logit</span>(subset_data, o, <span class="st">"pco2_cat_calc"</span>, <span class="st">"Calculated ABG"</span>))</span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-46"><a href="#cb128-46" aria-hidden="true" tabindex="-1"></a>combined_or_df <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span></span>
<span id="cb128-47"><a href="#cb128-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb128-48"><a href="#cb128-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="fu">recode</span>(term,</span>
<span id="cb128-49"><a href="#cb128-49" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"pco2_cat_abgBelow normal"</span>   <span class="ot">=</span> <span class="st">"Below normal"</span>,</span>
<span id="cb128-50"><a href="#cb128-50" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"pco2_cat_abgAbove normal"</span>   <span class="ot">=</span> <span class="st">"Above normal"</span>,</span>
<span id="cb128-51"><a href="#cb128-51" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"pco2_cat_vbgBelow normal"</span>   <span class="ot">=</span> <span class="st">"Below normal"</span>,</span>
<span id="cb128-52"><a href="#cb128-52" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"pco2_cat_vbgAbove normal"</span>   <span class="ot">=</span> <span class="st">"Above normal"</span>,</span>
<span id="cb128-53"><a href="#cb128-53" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"pco2_cat_calcBelow normal"</span>  <span class="ot">=</span> <span class="st">"Below normal"</span>,</span>
<span id="cb128-54"><a href="#cb128-54" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"pco2_cat_calcAbove normal"</span>  <span class="ot">=</span> <span class="st">"Above normal"</span>),</span>
<span id="cb128-55"><a href="#cb128-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">recode</span>(outcome,</span>
<span id="cb128-56"><a href="#cb128-56" aria-hidden="true" tabindex="-1"></a>                     <span class="at">imv_proc =</span> <span class="st">"Intubation"</span>,</span>
<span id="cb128-57"><a href="#cb128-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">niv_proc =</span> <span class="st">"NIV"</span>,</span>
<span id="cb128-58"><a href="#cb128-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">death_60d =</span> <span class="st">"Death (60d)"</span>,</span>
<span id="cb128-59"><a href="#cb128-59" aria-hidden="true" tabindex="-1"></a>                     <span class="at">hypercap_resp_failure =</span> <span class="st">"Hypercapnic RF"</span>)</span>
<span id="cb128-60"><a href="#cb128-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb128-61"><a href="#cb128-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(outcome, group, exposure, estimate, conf.low, conf.high)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>combined_or_df<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  combined_or_df<span class="sc">$</span>group,</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ABG"</span>, <span class="st">"VBG"</span>, <span class="st">"Calculated ABG"</span>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>  combined_or_df,</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x      =</span> outcome,</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y      =</span> estimate,</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin   =</span> conf.low,</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax   =</span> conf.high,</span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color  =</span> group,</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape  =</span> exposure</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(</span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>),</span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">size     =</span> <span class="fl">0.6</span></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(</span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>),</span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="dv">16</span>),</span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">title  =</span> <span class="st">"Odds Ratios of Outcomes by PCO2 Category (ABG, VBG, Calc-ABG)"</span>,</span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">x      =</span> <span class="st">"Outcome"</span>,</span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">y      =</span> <span class="st">"Odds Ratio (log scale, 95% CI)"</span>,</span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">color  =</span> <span class="st">"Blood-gas type"</span>,</span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape  =</span> <span class="st">"PCO2 category"</span>,</span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste</span>(</span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Odds ratios are computed within each blood-gas cohort."</span>,</span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Reference = patients in the normal PCO2 range."</span>,</span>
<span id="cb129-39"><a href="#cb129-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Below normal: &lt;35 mmHg. Above normal: &gt;45 mmHg (ABG, Calc-ABG) or &gt;50 mmHg (VBG)."</span>,</span>
<span id="cb129-40"><a href="#cb129-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Because the underlying cohorts differ (ABG, VBG, Calculated ABG), denominators are not identical across groups."</span>,</span>
<span id="cb129-41"><a href="#cb129-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb129-42"><a href="#cb129-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb129-43"><a href="#cb129-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb129-44"><a href="#cb129-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb129-45"><a href="#cb129-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Restricted Cubic Spline Regressions</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>subset_data_clean <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(paco2, vbg_co2, imv_proc, niv_proc, death_60d, hypercap_resp_failure)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>subset_data_clean <span class="ot">&lt;-</span> subset_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.))</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(subset_data_clean)</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">"dd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unweighted, Restricted Cubic Spline Regression - ABG by PaCO2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>fit_imv <span class="ot">&lt;-</span> <span class="fu">lrm</span>(imv_proc <span class="sc">~</span> <span class="fu">rcs</span>(paco2, <span class="dv">4</span>), <span class="at">data =</span> subset_data_clean)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>pred_imv <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_imv, paco2, <span class="at">fun =</span> plogis))</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>plot_imv <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_imv, <span class="fu">aes</span>(<span class="at">x =</span> paco2, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Probability of Intubation by PaCO₂"</span>,</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"PaCO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>fit_niv <span class="ot">&lt;-</span> <span class="fu">lrm</span>(niv_proc <span class="sc">~</span> <span class="fu">rcs</span>(paco2, <span class="dv">4</span>), <span class="at">data =</span> subset_data_clean)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>pred_niv <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_niv, paco2, <span class="at">fun =</span> plogis))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>plot_niv <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_niv, <span class="fu">aes</span>(<span class="at">x =</span> paco2, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Probability of NIV by PaCO₂"</span>,</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"PaCO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>fit_death <span class="ot">&lt;-</span> <span class="fu">lrm</span>(death_60d <span class="sc">~</span> <span class="fu">rcs</span>(paco2, <span class="dv">4</span>), <span class="at">data =</span> subset_data_clean)</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>pred_death <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_death, paco2, <span class="at">fun =</span> plogis))</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>plot_death <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_death, <span class="fu">aes</span>(<span class="at">x =</span> paco2, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Probability of Death by PaCO₂"</span>,</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"PaCO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>fit_hcrf <span class="ot">&lt;-</span> <span class="fu">lrm</span>(hypercap_resp_failure <span class="sc">~</span> <span class="fu">rcs</span>(paco2, <span class="dv">4</span>), <span class="at">data =</span> subset_data_clean)</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>pred_hcrf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_hcrf, paco2, <span class="at">fun =</span> plogis))</span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>plot_hcrf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_hcrf, <span class="fu">aes</span>(<span class="at">x =</span> paco2, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"purple"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Probability of Hypercapnic Respiratory Failure by PaCO₂"</span>,</span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"PaCO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a>(plot_imv <span class="sc">|</span> plot_niv) <span class="sc">/</span> (plot_death <span class="sc">|</span> plot_hcrf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Unweighted, Restricted Cubic Spline - VBG</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>subset_data_vbg <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vbg_co2, imv_proc, niv_proc, death_60d, hypercap_resp_failure) <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(vbg_co2) <span class="sc">&amp;</span> <span class="fu">complete.cases</span>(.))</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(subset_data_vbg)</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">"dd"</span>)</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>fit_imv_vbg <span class="ot">&lt;-</span> <span class="fu">lrm</span>(imv_proc <span class="sc">~</span> <span class="fu">rcs</span>(vbg_co2, <span class="dv">4</span>), <span class="at">data =</span> subset_data_vbg)</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>fit_niv_vbg <span class="ot">&lt;-</span> <span class="fu">lrm</span>(niv_proc <span class="sc">~</span> <span class="fu">rcs</span>(vbg_co2, <span class="dv">4</span>), <span class="at">data =</span> subset_data_vbg)</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>fit_death_vbg <span class="ot">&lt;-</span> <span class="fu">lrm</span>(death_60d <span class="sc">~</span> <span class="fu">rcs</span>(vbg_co2, <span class="dv">4</span>), <span class="at">data =</span> subset_data_vbg)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>fit_hcrf_vbg <span class="ot">&lt;-</span> <span class="fu">lrm</span>(hypercap_resp_failure <span class="sc">~</span> <span class="fu">rcs</span>(vbg_co2, <span class="dv">4</span>), <span class="at">data =</span> subset_data_vbg)</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>pred_imv_vbg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_imv_vbg, vbg_co2, <span class="at">fun =</span> plogis))</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>pred_niv_vbg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_niv_vbg, vbg_co2, <span class="at">fun =</span> plogis))</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>pred_death_vbg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_death_vbg, vbg_co2, <span class="at">fun =</span> plogis))</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>pred_hcrf_vbg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_hcrf_vbg, vbg_co2, <span class="at">fun =</span> plogis))</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>plot_imv_vbg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_imv_vbg, <span class="fu">aes</span>(<span class="at">x =</span> vbg_co2, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"IMV"</span>, <span class="at">x =</span> <span class="st">"VBG CO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>plot_niv_vbg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_niv_vbg, <span class="fu">aes</span>(<span class="at">x =</span> vbg_co2, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NIV"</span>, <span class="at">x =</span> <span class="st">"VBG CO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>plot_death_vbg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_death_vbg, <span class="fu">aes</span>(<span class="at">x =</span> vbg_co2, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Death"</span>, <span class="at">x =</span> <span class="st">"VBG CO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>plot_hcrf_vbg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_hcrf_vbg, <span class="fu">aes</span>(<span class="at">x =</span> vbg_co2, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"purple"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hypercapnic RF"</span>, <span class="at">x =</span> <span class="st">"VBG CO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>((plot_imv_vbg <span class="sc">|</span> plot_niv_vbg) <span class="sc">/</span></span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a> (plot_death_vbg <span class="sc">|</span> plot_hcrf_vbg)) <span class="sc">+</span></span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Predicted Probability by VBG CO₂ (RCS Models)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Unweighted, Restricted Cubic Spline Logistic Regressio - Calculated VBG to ABG (Farkas VBG Adjustment)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>subset_data_abg <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(calc_abg, imv_proc, niv_proc, death_60d, hypercap_resp_failure) <span class="sc">%&gt;%</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(calc_abg) <span class="sc">&amp;</span> <span class="fu">complete.cases</span>(.))</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(subset_data_abg)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">"dd"</span>)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>fit_imv_abg   <span class="ot">&lt;-</span> <span class="fu">lrm</span>(imv_proc <span class="sc">~</span> <span class="fu">rcs</span>(calc_abg, <span class="dv">4</span>), <span class="at">data =</span> subset_data_abg)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>fit_niv_abg   <span class="ot">&lt;-</span> <span class="fu">lrm</span>(niv_proc <span class="sc">~</span> <span class="fu">rcs</span>(calc_abg, <span class="dv">4</span>), <span class="at">data =</span> subset_data_abg)</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>fit_death_abg  <span class="ot">&lt;-</span> <span class="fu">lrm</span>(death_60d <span class="sc">~</span> <span class="fu">rcs</span>(calc_abg, <span class="dv">4</span>), <span class="at">data =</span> subset_data_abg)</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>fit_hcrf_abg   <span class="ot">&lt;-</span> <span class="fu">lrm</span>(hypercap_resp_failure <span class="sc">~</span> <span class="fu">rcs</span>(calc_abg, <span class="dv">4</span>), <span class="at">data =</span> subset_data_abg)</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>pred_imv_abg   <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_imv_abg, calc_abg, <span class="at">fun =</span> plogis))</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>pred_niv_abg   <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_niv_abg, calc_abg, <span class="at">fun =</span> plogis))</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>pred_death_abg <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_death_abg, calc_abg, <span class="at">fun =</span> plogis))</span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>pred_hcrf_abg  <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Predict</span>(fit_hcrf_abg, calc_abg, <span class="at">fun =</span> plogis))</span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>plot_imv_abg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_imv_abg, <span class="fu">aes</span>(<span class="at">x =</span> calc_abg, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"IMV"</span>, <span class="at">x =</span> <span class="st">"Calculated ABG CO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>plot_niv_abg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_niv_abg, <span class="fu">aes</span>(<span class="at">x =</span> calc_abg, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb135-26"><a href="#cb135-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb135-27"><a href="#cb135-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NIV"</span>, <span class="at">x =</span> <span class="st">"Calculated ABG CO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb135-28"><a href="#cb135-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb135-29"><a href="#cb135-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-30"><a href="#cb135-30" aria-hidden="true" tabindex="-1"></a>plot_death_abg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_death_abg, <span class="fu">aes</span>(<span class="at">x =</span> calc_abg, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb135-31"><a href="#cb135-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb135-32"><a href="#cb135-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb135-33"><a href="#cb135-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Death"</span>, <span class="at">x =</span> <span class="st">"Calculated ABG CO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb135-34"><a href="#cb135-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb135-35"><a href="#cb135-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-36"><a href="#cb135-36" aria-hidden="true" tabindex="-1"></a>plot_hcrf_abg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_hcrf_abg, <span class="fu">aes</span>(<span class="at">x =</span> calc_abg, <span class="at">y =</span> yhat)) <span class="sc">+</span></span>
<span id="cb135-37"><a href="#cb135-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb135-38"><a href="#cb135-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">fill =</span> <span class="st">"purple"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb135-39"><a href="#cb135-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hypercapnic RF"</span>, <span class="at">x =</span> <span class="st">"Calculated ABG CO₂ (mmHg)"</span>, <span class="at">y =</span> <span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb135-40"><a href="#cb135-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb135-41"><a href="#cb135-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-42"><a href="#cb135-42" aria-hidden="true" tabindex="-1"></a>((plot_imv_abg <span class="sc">|</span> plot_niv_abg) <span class="sc">/</span></span>
<span id="cb135-43"><a href="#cb135-43" aria-hidden="true" tabindex="-1"></a> (plot_death_abg <span class="sc">|</span> plot_hcrf_abg)) <span class="sc">+</span></span>
<span id="cb135-44"><a href="#cb135-44" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Predicted Probability by Calculated ABG CO₂ (RCS Models)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Inverse Propensity Weighting</strong></p>
<p>IPW done using Gradient Boosting Methods (GBM) - a type of decision-tree based machine learning. “<strong><em>Random forests and GBM are designed to automatically include relevant interactions for variables included in the model.</em></strong> As such, using a GBM to estimate the PS model, can reduce model misspecification, since <strong><em>the analyst is not required to identify relevant interactions or nonlinearities.”</em></strong> from this citation: PMID: <a href="https://pubmed.ncbi.nlm.nih.gov/39947224/">39947224</a><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC11825193/" class="uri">https://pmc.ncbi.nlm.nih.gov/articles/PMC11825193/</a></p>
<p>Current propensity score uses <strong>age_at_encounter + sex + race_ethnicity</strong> (remember - have to specify to use this as a factor variable) <strong>+ curr_bmi + copd + asthma + osa + chf + acute_nmd + phtn + location (as a factor variable)</strong></p>
<p>Note: for all these, I suggested new GBM adjustments that accomplish the following:</p>
<ol type="1">
<li><p>Smaller GBM &amp; stopping rule → faster fit, avoids over‑fitting, lighter tails (which lead to extreme weights that are problematic).</p></li>
<li><p>bal.tab() documents balance; aim is to adjust spec until standard mean difference (SMD)&nbsp;&lt; 0.1.</p></li>
<li><p>Weight stabilization (divide by mean) mitigates a few huge weights. I also winsorized, which is a way to avoid very extreme weights (ie you set &lt;1st percentile to the 1st percentile value, and &gt;99th percentile to 99th percentile.</p></li>
<li><p>Uses robust variance estimation (e.g.&nbsp;allows the variances to change by PaCO2) for IP‑weighted GLM; works with splines via rcs(). This is a bit nuanced but I think good to change even though it adds complexity</p></li>
<li><p>Deterministic seed ensures result replication.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 1. fit GBM propensity model, ABG ───────────────────────────────────────────────</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>weight_model <span class="ot">&lt;-</span> <span class="fu">weightit</span>(</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  has_abg <span class="sc">~</span> age_at_encounter <span class="sc">+</span> sex <span class="sc">+</span> <span class="fu">factor</span>(race_ethnicity) <span class="sc">+</span> curr_bmi <span class="sc">+</span> copd <span class="sc">+</span> asthma <span class="sc">+</span> osa <span class="sc">+</span> chf <span class="sc">+</span> acute_nmd <span class="sc">+</span> phtn <span class="sc">+</span> ckd <span class="sc">+</span> dm <span class="sc">+</span> <span class="fu">factor</span>(location) <span class="sc">+</span> temp_new <span class="sc">+</span> sbp <span class="sc">+</span> dbp <span class="sc">+</span> hr <span class="sc">+</span> spo2 <span class="sc">+</span> sodium <span class="sc">+</span> serum_cr <span class="sc">+</span> serum_hco3 <span class="sc">+</span> serum_cl <span class="sc">+</span> serum_lac <span class="sc">+</span> serum_k <span class="sc">+</span> wbc <span class="sc">+</span> plt <span class="sc">+</span> bnp <span class="sc">+</span> serum_phos <span class="sc">+</span> serum_ca,</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data        =</span> subset_data,</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method      =</span> <span class="st">"gbm"</span>,</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand    =</span> <span class="st">"ATE"</span>,</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">missing.    =</span> <span class="st">"ind"</span>,</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.trees     =</span> <span class="dv">3000</span>,</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">interaction.depth =</span> <span class="dv">3</span>,</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">shrinkage   =</span> <span class="fl">0.01</span>,</span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">bag.fraction=</span> <span class="fl">0.6</span>,</span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cv.folds    =</span> <span class="dv">5</span>,</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">stop.method =</span> <span class="st">"es.mean"</span>,</span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.cores     =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Missing values are present in the covariates. See
`?WeightIt::method_gbm` for information on how these are handled.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 2. Winsorise / stabilise weights (two‑sided) ─────────────────────────────</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> weight_model<span class="sc">$</span>weights            <span class="co"># original GBM weights</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> w <span class="sc">/</span> <span class="fu">mean</span>(w)                     <span class="co"># stabilise</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>cut <span class="ot">&lt;-</span> <span class="fu">quantile</span>(w, <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>w   <span class="ot">&lt;-</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(w, cut[<span class="dv">1</span>]), cut[<span class="dv">2</span>]) <span class="co"># two‑tail Winsorisation</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> w <span class="sc">/</span> <span class="fu">mean</span>(w)                     <span class="co"># re‑stabilise so E[w]=1</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="co"># overwrite inside the object and attach to data</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>weight_model<span class="sc">$</span>weights <span class="ot">&lt;-</span> w</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>subset_data<span class="sc">$</span>w_abg    <span class="ot">&lt;-</span> w</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 3. balance diagnostics (only raw vs. IPW) ────────────────────────────────</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>bal  <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(weight_model, <span class="at">un =</span> <span class="cn">TRUE</span>, <span class="at">m.threshold =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Missing values exist in the covariates. Displayed values omit these
observations.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">love.plot</span>(</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  bal,</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.order     =</span> <span class="st">"unadjusted"</span>,</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.names  =</span> <span class="fu">c</span>(<span class="st">"Raw"</span>, <span class="st">"IPW"</span>)    <span class="co"># rename legend entries</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Standardized mean differences and raw mean differences are present in
the same plot. Use the `stars` argument to distinguish between them and
appropriately label the x-axis. See `?love.plot` for details.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 4. survey design with the same weights ───────────────────────────────────</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>w_abg, <span class="at">data =</span> subset_data)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 5. outcome models (examples) ─────────────────────────────────────────────</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>fit_niv   <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(niv_proc   <span class="sc">~</span> has_abg, <span class="at">design =</span> design, <span class="at">family =</span> <span class="fu">quasibinomial</span>())</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>fit_imv   <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(imv_proc   <span class="sc">~</span> has_abg, <span class="at">design =</span> design, <span class="at">family =</span> <span class="fu">quasibinomial</span>())</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>fit_death <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(death_60d       <span class="sc">~</span> has_abg, <span class="at">design =</span> design, <span class="at">family =</span> <span class="fu">quasibinomial</span>())</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>fit_icd   <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(hypercap_resp_failure <span class="sc">~</span> has_abg, <span class="at">design =</span> design, <span class="at">family =</span> <span class="fu">quasibinomial</span>())</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="co"># quick effect estimates</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">list</span>(<span class="at">IMV =</span> fit_imv, <span class="at">NIV =</span> fit_niv, <span class="at">Death =</span> fit_death, <span class="at">ICD =</span> fit_icd), <span class="cf">function</span>(m) {</span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">OR  =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(m)[<span class="dv">2</span>]),</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">LCL =</span> <span class="fu">exp</span>(<span class="fu">confint</span>(m)[<span class="dv">2</span>,<span class="dv">1</span>]),</span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">UCL =</span> <span class="fu">exp</span>(<span class="fu">confint</span>(m)[<span class="dv">2</span>,<span class="dv">2</span>]))</span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$IMV
OR.has_abg        LCL        UCL 
  8.964670   8.738395   9.196804 

$NIV
OR.has_abg        LCL        UCL 
  2.814481   2.742068   2.888805 

$Death
OR.has_abg        LCL        UCL 
  2.618788   2.565055   2.673647 

$ICD
OR.has_abg        LCL        UCL 
  4.441543   4.315231   4.571553 </code></pre>
</div>
</div>
<p><strong>Inverse Propensity-Weighted Logistic Regressions with CO2 predictor represented as a restricted cubic spline.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(42)  # reproducible GBM fit</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # ── 1. inverse‑probability weights for receiving an ABG ───────────────────────</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # done in the last block, so not needed</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 2. analysis sample: rows with a measured PaCO₂ ────────────────────────────</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>subset_data_abg <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(paco2)) <span class="sc">%&gt;%</span>                    <span class="co"># implies has_abg == 1</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(paco2, imv_proc, niv_proc, death_60d,</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>         hypercap_resp_failure, w_abg) <span class="sc">%&gt;%</span></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.))</span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 3. weighted logistic spline models with robust SEs ───────────────────────</span></span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(subset_data_abg); <span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">"dd"</span>)</span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a>fitfun <span class="ot">&lt;-</span> <span class="cf">function</span>(formula)</span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svyglm</span>(</span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a>    formula,</span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">design =</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>w_abg, <span class="at">data =</span> subset_data_abg),</span>
<span id="cb144-23"><a href="#cb144-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">quasibinomial</span>()</span>
<span id="cb144-24"><a href="#cb144-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb144-25"><a href="#cb144-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-26"><a href="#cb144-26" aria-hidden="true" tabindex="-1"></a>fit_imv   <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(imv_proc              <span class="sc">~</span> <span class="fu">rcs</span>(paco2, <span class="dv">4</span>))</span>
<span id="cb144-27"><a href="#cb144-27" aria-hidden="true" tabindex="-1"></a>fit_niv   <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(niv_proc              <span class="sc">~</span> <span class="fu">rcs</span>(paco2, <span class="dv">4</span>))</span>
<span id="cb144-28"><a href="#cb144-28" aria-hidden="true" tabindex="-1"></a>fit_death <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(death_60d                  <span class="sc">~</span> <span class="fu">rcs</span>(paco2, <span class="dv">4</span>))</span>
<span id="cb144-29"><a href="#cb144-29" aria-hidden="true" tabindex="-1"></a>fit_hcrf  <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(hypercap_resp_failure <span class="sc">~</span> <span class="fu">rcs</span>(paco2, <span class="dv">4</span>))</span>
<span id="cb144-30"><a href="#cb144-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-31"><a href="#cb144-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 4. prediction helper ─────────────────────────────────────────────────────</span></span>
<span id="cb144-32"><a href="#cb144-32" aria-hidden="true" tabindex="-1"></a>mkpred <span class="ot">&lt;-</span> <span class="cf">function</span>(fit, data_ref) {</span>
<span id="cb144-33"><a href="#cb144-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Grid of PaCO₂ values</span></span>
<span id="cb144-34"><a href="#cb144-34" aria-hidden="true" tabindex="-1"></a>  newd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb144-35"><a href="#cb144-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">paco2 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_ref<span class="sc">$</span>paco2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb144-36"><a href="#cb144-36" aria-hidden="true" tabindex="-1"></a>                <span class="fu">max</span>(data_ref<span class="sc">$</span>paco2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb144-37"><a href="#cb144-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb144-38"><a href="#cb144-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb144-39"><a href="#cb144-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-40"><a href="#cb144-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Design (model) matrix for the new data</span></span>
<span id="cb144-41"><a href="#cb144-41" aria-hidden="true" tabindex="-1"></a>  mm <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="fu">delete.response</span>(<span class="fu">terms</span>(fit)),  <span class="co"># drop outcome</span></span>
<span id="cb144-42"><a href="#cb144-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> newd)</span>
<span id="cb144-43"><a href="#cb144-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-44"><a href="#cb144-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Linear predictor and its standard error</span></span>
<span id="cb144-45"><a href="#cb144-45" aria-hidden="true" tabindex="-1"></a>  eta  <span class="ot">&lt;-</span> mm <span class="sc">%*%</span> <span class="fu">coef</span>(fit)                        <span class="co"># β'x</span></span>
<span id="cb144-46"><a href="#cb144-46" aria-hidden="true" tabindex="-1"></a>  vcov <span class="ot">&lt;-</span> <span class="fu">vcov</span>(fit)                               <span class="co"># robust VCOV from svyglm</span></span>
<span id="cb144-47"><a href="#cb144-47" aria-hidden="true" tabindex="-1"></a>  se   <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>((mm <span class="sc">%*%</span> vcov) <span class="sc">*</span> mm))       <span class="co"># √diag(X Σ Xᵀ)</span></span>
<span id="cb144-48"><a href="#cb144-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-49"><a href="#cb144-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. Transform to probability scale</span></span>
<span id="cb144-50"><a href="#cb144-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb144-51"><a href="#cb144-51" aria-hidden="true" tabindex="-1"></a>    newd,</span>
<span id="cb144-52"><a href="#cb144-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">yhat  =</span> <span class="fu">plogis</span>(eta),</span>
<span id="cb144-53"><a href="#cb144-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">plogis</span>(eta <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se),</span>
<span id="cb144-54"><a href="#cb144-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">plogis</span>(eta <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb144-55"><a href="#cb144-55" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb144-56"><a href="#cb144-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-57"><a href="#cb144-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-58"><a href="#cb144-58" aria-hidden="true" tabindex="-1"></a>pred_imv   <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_imv,   subset_data_abg)</span>
<span id="cb144-59"><a href="#cb144-59" aria-hidden="true" tabindex="-1"></a>pred_niv   <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_niv,   subset_data_abg)</span>
<span id="cb144-60"><a href="#cb144-60" aria-hidden="true" tabindex="-1"></a>pred_death <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_death, subset_data_abg)</span>
<span id="cb144-61"><a href="#cb144-61" aria-hidden="true" tabindex="-1"></a>pred_hcrf  <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_hcrf,  subset_data_abg)</span>
<span id="cb144-62"><a href="#cb144-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-63"><a href="#cb144-63" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 5. plotting ──────────────────────────────────────────────────────────────</span></span>
<span id="cb144-64"><a href="#cb144-64" aria-hidden="true" tabindex="-1"></a>xlab <span class="ot">&lt;-</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"ABG CO"</span>[<span class="dv">2</span>], <span class="st">" (mmHg)"</span>))</span>
<span id="cb144-65"><a href="#cb144-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-66"><a href="#cb144-66" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, title)</span>
<span id="cb144-67"><a href="#cb144-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(paco2, yhat)) <span class="sc">+</span></span>
<span id="cb144-68"><a href="#cb144-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb144-69"><a href="#cb144-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb144-70"><a href="#cb144-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb144-71"><a href="#cb144-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">x =</span> xlab, <span class="at">y =</span> <span class="st">"Predicted probability"</span>) <span class="sc">+</span></span>
<span id="cb144-72"><a href="#cb144-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb144-73"><a href="#cb144-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-74"><a href="#cb144-74" aria-hidden="true" tabindex="-1"></a>(patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb144-75"><a href="#cb144-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_imv,   <span class="st">"IMV"</span>),</span>
<span id="cb144-76"><a href="#cb144-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_niv,   <span class="st">"NIV"</span>),</span>
<span id="cb144-77"><a href="#cb144-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_death, <span class="st">"Death"</span>),</span>
<span id="cb144-78"><a href="#cb144-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_hcrf,  <span class="st">"Hypercapnic RF"</span>),</span>
<span id="cb144-79"><a href="#cb144-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb144-80"><a href="#cb144-80" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb144-81"><a href="#cb144-81" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb144-82"><a href="#cb144-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb144-83"><a href="#cb144-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">expression</span>(</span>
<span id="cb144-84"><a href="#cb144-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"Propensity‑weighted predicted probability by ABG CO"</span>[<span class="dv">2</span>],</span>
<span id="cb144-85"><a href="#cb144-85" aria-hidden="true" tabindex="-1"></a>            <span class="st">" (restricted cubic spline)"</span>)</span>
<span id="cb144-86"><a href="#cb144-86" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb144-87"><a href="#cb144-87" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>VBG</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Inverse‑propensity weighting &amp; outcome modelling for **VBG** cohort</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    – mirrored 1‑to‑1 to the validated ABG workflow</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)   <span class="co"># identical seed for direct comparability</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Inverse‑probability weights for receiving a VBG ---------------------------</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>w_vbg <span class="ot">&lt;-</span> <span class="fu">weightit</span>(</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>  has_vbg <span class="sc">~</span> age_at_encounter <span class="sc">+</span> sex <span class="sc">+</span> <span class="fu">factor</span>(race_ethnicity) <span class="sc">+</span> curr_bmi <span class="sc">+</span> copd <span class="sc">+</span> asthma <span class="sc">+</span> osa <span class="sc">+</span> chf <span class="sc">+</span> acute_nmd <span class="sc">+</span> phtn <span class="sc">+</span> ckd <span class="sc">+</span> dm <span class="sc">+</span> <span class="fu">factor</span>(location) <span class="sc">+</span> temp_new <span class="sc">+</span> sbp <span class="sc">+</span> dbp <span class="sc">+</span> hr <span class="sc">+</span> spo2 <span class="sc">+</span> sodium <span class="sc">+</span> serum_cr <span class="sc">+</span> serum_hco3 <span class="sc">+</span> serum_cl <span class="sc">+</span> serum_lac <span class="sc">+</span> serum_k <span class="sc">+</span> wbc <span class="sc">+</span> plt <span class="sc">+</span> bnp <span class="sc">+</span> serum_phos <span class="sc">+</span> serum_ca,</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data        =</span> subset_data,</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">method      =</span> <span class="st">"gbm"</span>,</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand    =</span> <span class="st">"ATE"</span>,</span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">missing.    =</span> <span class="st">"ind"</span>,</span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.trees     =</span> <span class="dv">3000</span>,</span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">interaction.depth =</span> <span class="dv">3</span>,</span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">shrinkage   =</span> <span class="fl">0.01</span>,</span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">bag.fraction=</span> <span class="fl">0.6</span>,</span>
<span id="cb145-18"><a href="#cb145-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cv.folds    =</span> <span class="dv">5</span>,</span>
<span id="cb145-19"><a href="#cb145-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">stop.method =</span> <span class="st">"es.mean"</span>,</span>
<span id="cb145-20"><a href="#cb145-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.cores     =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb145-21"><a href="#cb145-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Missing values are present in the covariates. See
`?WeightIt::method_gbm` for information on how these are handled.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 2. Winsorise / stabilise weights (two‑sided) ─────────────────────────────</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> w_vbg<span class="sc">$</span>weights            <span class="co"># original GBM weights</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> w <span class="sc">/</span> <span class="fu">mean</span>(w)                     <span class="co"># stabilise</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>cut <span class="ot">&lt;-</span> <span class="fu">quantile</span>(w, <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>w   <span class="ot">&lt;-</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(w, cut[<span class="dv">1</span>]), cut[<span class="dv">2</span>]) <span class="co"># two‑tail Winsorisation</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> w <span class="sc">/</span> <span class="fu">mean</span>(w)                     <span class="co"># re‑stabilise so E[w]=1</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="co"># overwrite inside the object and attach to data</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>w_vbg<span class="sc">$</span>weights <span class="ot">&lt;-</span> w</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>subset_data<span class="sc">$</span>w_vbg    <span class="ot">&lt;-</span> w</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(w_vbg, <span class="at">un =</span> <span class="cn">TRUE</span>, <span class="at">m.threshold =</span> <span class="fl">0.1</span>)      <span class="co"># inspect balance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Missing values exist in the covariates. Displayed values omit these
observations.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Balance Measures
                             Type Diff.Un Diff.Adj        M.Threshold
prop.score               Distance  1.7376   0.8096                   
age_at_encounter          Contin.  0.0555   0.0537     Balanced, &lt;0.1
sex                        Binary  0.0774   0.0525     Balanced, &lt;0.1
factor(race_ethnicity)_0   Binary -0.1141  -0.0398     Balanced, &lt;0.1
factor(race_ethnicity)_1   Binary  0.0199   0.0209     Balanced, &lt;0.1
factor(race_ethnicity)_2   Binary  0.0086   0.0072     Balanced, &lt;0.1
factor(race_ethnicity)_3   Binary  0.0068   0.0037     Balanced, &lt;0.1
factor(race_ethnicity)_4   Binary  0.0065   0.0035     Balanced, &lt;0.1
factor(race_ethnicity)_5   Binary -0.0007  -0.0006     Balanced, &lt;0.1
factor(race_ethnicity)_6   Binary  0.0730   0.0051     Balanced, &lt;0.1
curr_bmi                  Contin. -0.6873  -0.4849 Not Balanced, &gt;0.1
curr_bmi:&lt;NA&gt;              Binary  0.1721   0.1157 Not Balanced, &gt;0.1
copd                       Binary  0.0216   0.0214     Balanced, &lt;0.1
asthma                     Binary -0.0185  -0.0144     Balanced, &lt;0.1
osa                        Binary -0.0686  -0.0496     Balanced, &lt;0.1
chf                        Binary  0.0539   0.0407     Balanced, &lt;0.1
acute_nmd                  Binary  0.0004   0.0002     Balanced, &lt;0.1
phtn                       Binary  0.0280   0.0208     Balanced, &lt;0.1
ckd                        Binary  0.0566   0.0405     Balanced, &lt;0.1
dm                         Binary  0.0279   0.0167     Balanced, &lt;0.1
factor(location)_0         Binary -0.2073  -0.1000     Balanced, &lt;0.1
factor(location)_1         Binary  0.2425   0.0932     Balanced, &lt;0.1
factor(location)_2         Binary -0.0008   0.0167     Balanced, &lt;0.1
factor(location)_3         Binary -0.0344  -0.0100     Balanced, &lt;0.1
temp_new                  Contin.  0.0190   0.0184     Balanced, &lt;0.1
temp_new:&lt;NA&gt;              Binary -0.0556   0.0162     Balanced, &lt;0.1
sbp                       Contin. -0.2155  -0.0668     Balanced, &lt;0.1
sbp:&lt;NA&gt;                   Binary  0.1613   0.0628     Balanced, &lt;0.1
dbp                       Contin. -0.2374  -0.1199 Not Balanced, &gt;0.1
dbp:&lt;NA&gt;                   Binary  0.1618   0.0636     Balanced, &lt;0.1
hr                        Contin.  0.2672   0.1496 Not Balanced, &gt;0.1
hr:&lt;NA&gt;                    Binary  0.0323   0.0218     Balanced, &lt;0.1
spo2                      Contin. -0.3538  -0.1780 Not Balanced, &gt;0.1
spo2:&lt;NA&gt;                  Binary -0.0994  -0.0384     Balanced, &lt;0.1
sodium                    Contin. -0.2175  -0.0939     Balanced, &lt;0.1
sodium:&lt;NA&gt;                Binary -0.2840  -0.1975 Not Balanced, &gt;0.1
serum_cr                  Contin.  0.1611   0.0640     Balanced, &lt;0.1
serum_cr:&lt;NA&gt;              Binary -0.2778  -0.1792 Not Balanced, &gt;0.1
serum_hco3                Contin. -0.1656  -0.0558     Balanced, &lt;0.1
serum_hco3:&lt;NA&gt;            Binary -0.2805  -0.1902 Not Balanced, &gt;0.1
serum_cl                  Contin. -0.2330  -0.0950     Balanced, &lt;0.1
serum_cl:&lt;NA&gt;              Binary -0.2831  -0.1918 Not Balanced, &gt;0.1
serum_lac                 Contin.  0.1521   0.0378     Balanced, &lt;0.1
serum_lac:&lt;NA&gt;             Binary -0.3222  -0.1322 Not Balanced, &gt;0.1
serum_k                   Contin. -0.0216  -0.0226     Balanced, &lt;0.1
serum_k:&lt;NA&gt;               Binary -0.2637  -0.1767 Not Balanced, &gt;0.1
wbc                       Contin.  0.1085   0.0488     Balanced, &lt;0.1
wbc:&lt;NA&gt;                   Binary -0.3520  -0.2352 Not Balanced, &gt;0.1
plt                       Contin. -0.0591  -0.0463     Balanced, &lt;0.1
plt:&lt;NA&gt;                   Binary -0.3042  -0.2079 Not Balanced, &gt;0.1
bnp                       Contin.  0.0362  -0.0062     Balanced, &lt;0.1
bnp:&lt;NA&gt;                   Binary -0.0956  -0.0648     Balanced, &lt;0.1
serum_phos                Contin.  0.0612   0.0069     Balanced, &lt;0.1
serum_phos:&lt;NA&gt;            Binary -0.3533  -0.1713 Not Balanced, &gt;0.1
serum_ca                  Contin. -0.1731  -0.0900     Balanced, &lt;0.1
serum_ca:&lt;NA&gt;              Binary -0.2545  -0.1632 Not Balanced, &gt;0.1

Balance tally for mean differences
                   count
Balanced, &lt;0.1        40
Not Balanced, &gt;0.1    15

Variable with the greatest mean difference
 Variable Diff.Adj        M.Threshold
 curr_bmi  -0.4849 Not Balanced, &gt;0.1

Effective sample sizes
            Control  Treated
Unadjusted 677009.  156467. 
Adjusted   601191.6 108620.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Analysis sample: rows with measured VBG CO₂ --------------------------------</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>subset_data_vbg <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(vbg_co2)) <span class="sc">%&gt;%</span>                     <span class="co"># implies has_vbg == 1</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vbg_co2, imv_proc, niv_proc, death_60d, </span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>         hypercap_resp_failure, w_vbg) <span class="sc">%&gt;%</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.))</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Weighted logistic spline models with robust SEs ---------------------------</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(subset_data_vbg); <span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">"dd"</span>)</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>fitfun <span class="ot">&lt;-</span> <span class="cf">function</span>(formula)</span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svyglm</span>(</span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>    formula,</span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">design =</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>w_vbg, <span class="at">data =</span> subset_data_vbg),</span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">quasibinomial</span>()</span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a>fit_imv_vbg   <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(imv_proc              <span class="sc">~</span> <span class="fu">rcs</span>(vbg_co2, <span class="dv">4</span>))</span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a>fit_niv_vbg   <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(niv_proc              <span class="sc">~</span> <span class="fu">rcs</span>(vbg_co2, <span class="dv">4</span>))</span>
<span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a>fit_death_vbg <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(death_60d                 <span class="sc">~</span> <span class="fu">rcs</span>(vbg_co2, <span class="dv">4</span>))</span>
<span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a>fit_hcrf_vbg  <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(hypercap_resp_failure <span class="sc">~</span> <span class="fu">rcs</span>(vbg_co2, <span class="dv">4</span>))</span>
<span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Prediction helper (robust to predict() quirks) ----------------------------</span></span>
<span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a>mkpred <span class="ot">&lt;-</span> <span class="cf">function</span>(fit, data_ref) {</span>
<span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a>  newd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">vbg_co2 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_ref<span class="sc">$</span>vbg_co2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">max</span>(data_ref<span class="sc">$</span>vbg_co2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb150-28"><a href="#cb150-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb150-29"><a href="#cb150-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb150-30"><a href="#cb150-30" aria-hidden="true" tabindex="-1"></a>  mm   <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="fu">delete.response</span>(<span class="fu">terms</span>(fit)), newd)</span>
<span id="cb150-31"><a href="#cb150-31" aria-hidden="true" tabindex="-1"></a>  eta  <span class="ot">&lt;-</span> mm <span class="sc">%*%</span> <span class="fu">coef</span>(fit)</span>
<span id="cb150-32"><a href="#cb150-32" aria-hidden="true" tabindex="-1"></a>  vcov <span class="ot">&lt;-</span> <span class="fu">vcov</span>(fit)</span>
<span id="cb150-33"><a href="#cb150-33" aria-hidden="true" tabindex="-1"></a>  se   <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>((mm <span class="sc">%*%</span> vcov) <span class="sc">*</span> mm))</span>
<span id="cb150-34"><a href="#cb150-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb150-35"><a href="#cb150-35" aria-hidden="true" tabindex="-1"></a>    newd,</span>
<span id="cb150-36"><a href="#cb150-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">yhat  =</span> <span class="fu">plogis</span>(eta),</span>
<span id="cb150-37"><a href="#cb150-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">plogis</span>(eta <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se),</span>
<span id="cb150-38"><a href="#cb150-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">plogis</span>(eta <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb150-39"><a href="#cb150-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb150-40"><a href="#cb150-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb150-41"><a href="#cb150-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-42"><a href="#cb150-42" aria-hidden="true" tabindex="-1"></a>pred_imv_vbg   <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_imv_vbg,   subset_data_vbg)</span>
<span id="cb150-43"><a href="#cb150-43" aria-hidden="true" tabindex="-1"></a>pred_niv_vbg   <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_niv_vbg,   subset_data_vbg)</span>
<span id="cb150-44"><a href="#cb150-44" aria-hidden="true" tabindex="-1"></a>pred_death_vbg <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_death_vbg, subset_data_vbg)</span>
<span id="cb150-45"><a href="#cb150-45" aria-hidden="true" tabindex="-1"></a>pred_hcrf_vbg  <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_hcrf_vbg,  subset_data_vbg)</span>
<span id="cb150-46"><a href="#cb150-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-47"><a href="#cb150-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Plotting -------------------------------------------------------------------</span></span>
<span id="cb150-48"><a href="#cb150-48" aria-hidden="true" tabindex="-1"></a>xlab <span class="ot">&lt;-</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"VBG CO"</span>[<span class="dv">2</span>], <span class="st">" (mmHg)"</span>))</span>
<span id="cb150-49"><a href="#cb150-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-50"><a href="#cb150-50" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, title)</span>
<span id="cb150-51"><a href="#cb150-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(vbg_co2, yhat)) <span class="sc">+</span></span>
<span id="cb150-52"><a href="#cb150-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb150-53"><a href="#cb150-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb150-54"><a href="#cb150-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>))  <span class="sc">+</span></span>
<span id="cb150-55"><a href="#cb150-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">x =</span> xlab, <span class="at">y =</span> <span class="st">"Predicted probability"</span>) <span class="sc">+</span></span>
<span id="cb150-56"><a href="#cb150-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb150-57"><a href="#cb150-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-58"><a href="#cb150-58" aria-hidden="true" tabindex="-1"></a>(patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb150-59"><a href="#cb150-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_imv_vbg,   <span class="st">"IMV"</span>),</span>
<span id="cb150-60"><a href="#cb150-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_niv_vbg,   <span class="st">"NIV"</span>),</span>
<span id="cb150-61"><a href="#cb150-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_death_vbg, <span class="st">"Death"</span>),</span>
<span id="cb150-62"><a href="#cb150-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_hcrf_vbg,  <span class="st">"Hypercapnic RF"</span>),</span>
<span id="cb150-63"><a href="#cb150-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb150-64"><a href="#cb150-64" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb150-65"><a href="#cb150-65" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb150-66"><a href="#cb150-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb150-67"><a href="#cb150-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">expression</span>(</span>
<span id="cb150-68"><a href="#cb150-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"Propensity‑weighted predicted probability by VBG CO"</span>[<span class="dv">2</span>],</span>
<span id="cb150-69"><a href="#cb150-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">" (restricted cubic spline)"</span>)</span>
<span id="cb150-70"><a href="#cb150-70" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb150-71"><a href="#cb150-71" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Calculated VBG to ABG / Farkas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Propensity‑weighted spline models for **Calculated ABG CO₂**</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    (weights still derive from propensity to receive a VBG)</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 1. define the new treatment variable --------------------------------------</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_vbg_co2_o2_sat =</span> <span class="fu">if_else</span>(</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(vbg_co2)  <span class="sc">&amp;</span> vbg_co2  <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(vbg_o2sat) <span class="sc">&amp;</span> vbg_o2sat <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>, <span class="dv">0</span></span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a><span class="co"># quick sanity check</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a><span class="co"># table(subset_data$has_vbg_co2_o2_sat, useNA = "ifany")</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 2. fit the GBM propensity model -------------------------------------------</span></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>w_vbg_calc <span class="ot">&lt;-</span> <span class="fu">weightit</span>(</span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>  has_vbg_co2_o2_sat <span class="sc">~</span> age_at_encounter <span class="sc">+</span> sex <span class="sc">+</span> <span class="fu">factor</span>(race_ethnicity) <span class="sc">+</span> curr_bmi <span class="sc">+</span> copd <span class="sc">+</span> asthma <span class="sc">+</span> osa <span class="sc">+</span> chf <span class="sc">+</span> acute_nmd <span class="sc">+</span> phtn <span class="sc">+</span> ckd <span class="sc">+</span> dm <span class="sc">+</span> <span class="fu">factor</span>(location) <span class="sc">+</span> temp_new <span class="sc">+</span> sbp <span class="sc">+</span> dbp <span class="sc">+</span> hr <span class="sc">+</span> spo2 <span class="sc">+</span> sodium <span class="sc">+</span> serum_cr <span class="sc">+</span> serum_hco3 <span class="sc">+</span> serum_cl <span class="sc">+</span> serum_lac <span class="sc">+</span> serum_k <span class="sc">+</span> wbc <span class="sc">+</span> plt <span class="sc">+</span> bnp <span class="sc">+</span> serum_phos <span class="sc">+</span> serum_ca,</span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">data        =</span> subset_data,</span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">method      =</span> <span class="st">"gbm"</span>,</span>
<span id="cb151-24"><a href="#cb151-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand    =</span> <span class="st">"ATE"</span>,</span>
<span id="cb151-25"><a href="#cb151-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">missing.    =</span> <span class="st">"ind"</span>,</span>
<span id="cb151-26"><a href="#cb151-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.trees     =</span> <span class="dv">3000</span>,</span>
<span id="cb151-27"><a href="#cb151-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">interaction.depth =</span> <span class="dv">3</span>,</span>
<span id="cb151-28"><a href="#cb151-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">shrinkage   =</span> <span class="fl">0.01</span>,</span>
<span id="cb151-29"><a href="#cb151-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">bag.fraction=</span> <span class="fl">0.6</span>,</span>
<span id="cb151-30"><a href="#cb151-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">cv.folds    =</span> <span class="dv">5</span>,</span>
<span id="cb151-31"><a href="#cb151-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">stop.method =</span> <span class="st">"es.mean"</span>,</span>
<span id="cb151-32"><a href="#cb151-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.cores     =</span> <span class="fu">detectCores</span>()</span>
<span id="cb151-33"><a href="#cb151-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Missing values are present in the covariates. See
`?WeightIt::method_gbm` for information on how these are handled.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 3. (optional) stabilise + two‑sided Winsorisation --------------------------</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> w_vbg_calc<span class="sc">$</span>weights</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> w <span class="sc">/</span> <span class="fu">mean</span>(w)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>cut <span class="ot">&lt;-</span> <span class="fu">quantile</span>(w, <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>w   <span class="ot">&lt;-</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(w, cut[<span class="dv">1</span>]), cut[<span class="dv">2</span>])</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>w   <span class="ot">&lt;-</span> w <span class="sc">/</span> <span class="fu">mean</span>(w)</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>subset_data<span class="sc">$</span>w_vbg_calc <span class="ot">&lt;-</span> w          <span class="co"># attach to data frame</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>w_vbg_calc<span class="sc">$</span>weights     <span class="ot">&lt;-</span> w          <span class="co"># overwrite inside object for diagnostics</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(w_vbg_calc, <span class="at">un =</span> <span class="cn">TRUE</span>, <span class="at">m.threshold =</span> <span class="fl">0.1</span>)   <span class="co"># inspect balance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Missing values exist in the covariates. Displayed values omit these
observations.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Balance Measures
                             Type Diff.Un Diff.Adj        M.Threshold
prop.score               Distance  1.9089   1.1845                   
age_at_encounter          Contin.  0.1075   0.1042 Not Balanced, &gt;0.1
sex                        Binary  0.0563   0.0424     Balanced, &lt;0.1
factor(race_ethnicity)_0   Binary  0.0047   0.0114     Balanced, &lt;0.1
factor(race_ethnicity)_1   Binary  0.0868   0.0529     Balanced, &lt;0.1
factor(race_ethnicity)_2   Binary -0.0185  -0.0119     Balanced, &lt;0.1
factor(race_ethnicity)_3   Binary  0.0003  -0.0002     Balanced, &lt;0.1
factor(race_ethnicity)_4   Binary  0.0021   0.0038     Balanced, &lt;0.1
factor(race_ethnicity)_5   Binary -0.0007  -0.0005     Balanced, &lt;0.1
factor(race_ethnicity)_6   Binary -0.0747  -0.0554     Balanced, &lt;0.1
curr_bmi                  Contin. -0.5427  -0.4066 Not Balanced, &gt;0.1
curr_bmi:&lt;NA&gt;              Binary  0.1894   0.1544 Not Balanced, &gt;0.1
copd                       Binary  0.0405   0.0340     Balanced, &lt;0.1
asthma                     Binary -0.0314  -0.0255     Balanced, &lt;0.1
osa                        Binary -0.0598  -0.0489     Balanced, &lt;0.1
chf                        Binary  0.0673   0.0491     Balanced, &lt;0.1
acute_nmd                  Binary  0.0008   0.0005     Balanced, &lt;0.1
phtn                       Binary  0.0335   0.0260     Balanced, &lt;0.1
ckd                        Binary  0.0563   0.0429     Balanced, &lt;0.1
dm                         Binary  0.0372   0.0221     Balanced, &lt;0.1
factor(location)_0         Binary  0.0479  -0.0000     Balanced, &lt;0.1
factor(location)_1         Binary  0.0449   0.0666     Balanced, &lt;0.1
factor(location)_2         Binary  0.0915   0.0817     Balanced, &lt;0.1
factor(location)_3         Binary -0.1844  -0.1483 Not Balanced, &gt;0.1
temp_new                  Contin.  0.1034  -0.0136     Balanced, &lt;0.1
temp_new:&lt;NA&gt;              Binary  0.0858   0.1310 Not Balanced, &gt;0.1
sbp                       Contin. -0.1075  -0.0578     Balanced, &lt;0.1
sbp:&lt;NA&gt;                   Binary -0.0444  -0.0954     Balanced, &lt;0.1
dbp                       Contin. -0.1453  -0.1148 Not Balanced, &gt;0.1
dbp:&lt;NA&gt;                   Binary -0.0451  -0.0962     Balanced, &lt;0.1
hr                        Contin.  0.1345   0.0379     Balanced, &lt;0.1
hr:&lt;NA&gt;                    Binary  0.2800   0.2234 Not Balanced, &gt;0.1
spo2                      Contin. -0.6873  -0.5332 Not Balanced, &gt;0.1
spo2:&lt;NA&gt;                  Binary  0.1243   0.0839     Balanced, &lt;0.1
sodium                    Contin. -0.2153  -0.1068 Not Balanced, &gt;0.1
sodium:&lt;NA&gt;                Binary -0.2659  -0.2376 Not Balanced, &gt;0.1
serum_cr                  Contin.  0.1431   0.0717     Balanced, &lt;0.1
serum_cr:&lt;NA&gt;              Binary -0.2266  -0.2029 Not Balanced, &gt;0.1
serum_hco3                Contin. -0.0857  -0.0518     Balanced, &lt;0.1
serum_hco3:&lt;NA&gt;            Binary -0.2639  -0.2322 Not Balanced, &gt;0.1
serum_cl                  Contin. -0.2656  -0.1462 Not Balanced, &gt;0.1
serum_cl:&lt;NA&gt;              Binary -0.2647  -0.2331 Not Balanced, &gt;0.1
serum_lac                 Contin.  0.1387   0.0657     Balanced, &lt;0.1
serum_lac:&lt;NA&gt;             Binary -0.2537  -0.1693 Not Balanced, &gt;0.1
serum_k                   Contin.  0.0186  -0.0032     Balanced, &lt;0.1
serum_k:&lt;NA&gt;               Binary -0.2105  -0.1924 Not Balanced, &gt;0.1
wbc                       Contin.  0.1085   0.0616     Balanced, &lt;0.1
wbc:&lt;NA&gt;                   Binary -0.2858  -0.2458 Not Balanced, &gt;0.1
plt                       Contin. -0.0651  -0.0603     Balanced, &lt;0.1
plt:&lt;NA&gt;                   Binary -0.2959  -0.2571 Not Balanced, &gt;0.1
bnp                       Contin.  0.0889   0.0752     Balanced, &lt;0.1
bnp:&lt;NA&gt;                   Binary -0.1973  -0.1101 Not Balanced, &gt;0.1
serum_phos                Contin.  0.0458   0.0077     Balanced, &lt;0.1
serum_phos:&lt;NA&gt;            Binary -0.2682  -0.1695 Not Balanced, &gt;0.1
serum_ca                  Contin. -0.1397  -0.0948     Balanced, &lt;0.1
serum_ca:&lt;NA&gt;              Binary -0.1992  -0.1766 Not Balanced, &gt;0.1

Balance tally for mean differences
                   count
Balanced, &lt;0.1        34
Not Balanced, &gt;0.1    21

Variable with the greatest mean difference
 Variable Diff.Adj        M.Threshold
     spo2  -0.5332 Not Balanced, &gt;0.1

Effective sample sizes
            Control  Treated
Unadjusted 765225.  68251.  
Adjusted   735299.8 53459.27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Analysis sample: rows with a calculated ABG CO₂ ---------------------------</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>subset_data_calc <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(calc_abg)) <span class="sc">%&gt;%</span>                       <span class="co"># implies has_vbg == 1</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(calc_abg, imv_proc, niv_proc, death_60d,</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>         hypercap_resp_failure, w_vbg_calc) <span class="sc">%&gt;%</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) </span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Weighted logistic spline models with robust SEs ---------------------------</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(subset_data_calc); <span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">"dd"</span>)</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>fitfun <span class="ot">&lt;-</span> <span class="cf">function</span>(formula)</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svyglm</span>(</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>    formula,</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">design =</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>w_vbg_calc, <span class="at">data =</span> subset_data_calc),</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">quasibinomial</span>()</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>fit_imv_calc   <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(imv_proc              <span class="sc">~</span> <span class="fu">rcs</span>(calc_abg, <span class="dv">4</span>))</span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>fit_niv_calc   <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(niv_proc              <span class="sc">~</span> <span class="fu">rcs</span>(calc_abg, <span class="dv">4</span>))</span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>fit_death_calc <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(death_60d                  <span class="sc">~</span> <span class="fu">rcs</span>(calc_abg, <span class="dv">4</span>))</span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>fit_hcrf_calc  <span class="ot">&lt;-</span> <span class="fu">fitfun</span>(hypercap_resp_failure <span class="sc">~</span> <span class="fu">rcs</span>(calc_abg, <span class="dv">4</span>))</span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Prediction helper ---------------------------------------------------------</span></span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>mkpred <span class="ot">&lt;-</span> <span class="cf">function</span>(fit, data_ref) {</span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>  newd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">calc_abg =</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_ref<span class="sc">$</span>calc_abg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">max</span>(data_ref<span class="sc">$</span>calc_abg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>  mm   <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="fu">delete.response</span>(<span class="fu">terms</span>(fit)), newd)</span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>  eta  <span class="ot">&lt;-</span> mm <span class="sc">%*%</span> <span class="fu">coef</span>(fit)</span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>  vcov <span class="ot">&lt;-</span> <span class="fu">vcov</span>(fit)</span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>  se   <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>((mm <span class="sc">%*%</span> vcov) <span class="sc">*</span> mm))</span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(</span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>    newd,</span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">yhat  =</span> <span class="fu">plogis</span>(eta),</span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">plogis</span>(eta <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se),</span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">plogis</span>(eta <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se)</span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb156-40"><a href="#cb156-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb156-41"><a href="#cb156-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-42"><a href="#cb156-42" aria-hidden="true" tabindex="-1"></a>pred_imv_calc   <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_imv_calc,   subset_data_calc)</span>
<span id="cb156-43"><a href="#cb156-43" aria-hidden="true" tabindex="-1"></a>pred_niv_calc   <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_niv_calc,   subset_data_calc)</span>
<span id="cb156-44"><a href="#cb156-44" aria-hidden="true" tabindex="-1"></a>pred_death_calc <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_death_calc, subset_data_calc)</span>
<span id="cb156-45"><a href="#cb156-45" aria-hidden="true" tabindex="-1"></a>pred_hcrf_calc  <span class="ot">&lt;-</span> <span class="fu">mkpred</span>(fit_hcrf_calc,  subset_data_calc)</span>
<span id="cb156-46"><a href="#cb156-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-47"><a href="#cb156-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Plotting -------------------------------------------------------------------</span></span>
<span id="cb156-48"><a href="#cb156-48" aria-hidden="true" tabindex="-1"></a>xlab <span class="ot">&lt;-</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Calculated ABG CO"</span>[<span class="dv">2</span>], <span class="st">" (mmHg)"</span>))</span>
<span id="cb156-49"><a href="#cb156-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-50"><a href="#cb156-50" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, title)</span>
<span id="cb156-51"><a href="#cb156-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(calc_abg, yhat)) <span class="sc">+</span></span>
<span id="cb156-52"><a href="#cb156-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb156-53"><a href="#cb156-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb156-54"><a href="#cb156-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>))  <span class="sc">+</span></span>
<span id="cb156-55"><a href="#cb156-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">x =</span> xlab, <span class="at">y =</span> <span class="st">"Predicted probability"</span>) <span class="sc">+</span></span>
<span id="cb156-56"><a href="#cb156-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb156-57"><a href="#cb156-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-58"><a href="#cb156-58" aria-hidden="true" tabindex="-1"></a>(patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb156-59"><a href="#cb156-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_imv_calc,   <span class="st">"IMV"</span>),</span>
<span id="cb156-60"><a href="#cb156-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_niv_calc,   <span class="st">"NIV"</span>),</span>
<span id="cb156-61"><a href="#cb156-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_death_calc, <span class="st">"Death"</span>),</span>
<span id="cb156-62"><a href="#cb156-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plt</span>(pred_hcrf_calc,  <span class="st">"Hypercapnic RF"</span>),</span>
<span id="cb156-63"><a href="#cb156-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb156-64"><a href="#cb156-64" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb156-65"><a href="#cb156-65" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb156-66"><a href="#cb156-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb156-67"><a href="#cb156-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">expression</span>(</span>
<span id="cb156-68"><a href="#cb156-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="st">"Propensity‑weighted predicted probability by Calculated ABG CO"</span>[<span class="dv">2</span>],</span>
<span id="cb156-69"><a href="#cb156-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">" (restricted cubic spline)"</span>)</span>
<span id="cb156-70"><a href="#cb156-70" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb156-71"><a href="#cb156-71" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>New</strong> weighted binary regression figures.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  IP‑weighted odds‑ratio plot (ABG, VBG, Calculated‑ABG)</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    – exact analogue of the un‑weighted figure</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ──────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="co"># weights already attached earlier:</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   • w_abg         – propensity for *ABG*   (column in subset_data)</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   • w_vbg         – propensity for *VBG*   (column in subset_data)</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   • w_vbg_calc    – same weights, used for calculated ABG CO₂</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. helper to fit an IP‑weighted GLM and return tidy OR -----------------------</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>tidy_ipw <span class="ot">&lt;-</span> <span class="cf">function</span>(data, outcome, exposure, weight_var,</span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>                     group_label, outcome_label) {</span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>  des <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, weight_var)),</span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> data)</span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.formula</span>(<span class="fu">paste0</span>(outcome, <span class="st">" ~ "</span>, exposure)),</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">design =</span> des,</span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">quasibinomial</span>()</span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(mod, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> exposure) <span class="sc">%&gt;%</span>                <span class="co"># keep the exposure row</span></span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group =</span> group_label, <span class="at">outcome =</span> outcome_label)</span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. cohort‑specific data frames ----------------------------------------------</span></span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>abg_df   <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(has_abg <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>vbg_df   <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(has_vbg <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a>calc_df  <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(calc_abg))   <span class="co"># implies VBG present</span></span>
<span id="cb157-30"><a href="#cb157-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-31"><a href="#cb157-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. fit models &amp; collect estimates -------------------------------------------</span></span>
<span id="cb157-32"><a href="#cb157-32" aria-hidden="true" tabindex="-1"></a>ipw_estimates <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb157-33"><a href="#cb157-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ABG</span></span>
<span id="cb157-34"><a href="#cb157-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(abg_df,  <span class="st">"imv_proc"</span>,              <span class="st">"hypercap_on_abg"</span>, <span class="st">"w_abg"</span>,      <span class="st">"ABG"</span>,           <span class="st">"Intubation"</span>),</span>
<span id="cb157-35"><a href="#cb157-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(abg_df,  <span class="st">"niv_proc"</span>,              <span class="st">"hypercap_on_abg"</span>, <span class="st">"w_abg"</span>,      <span class="st">"ABG"</span>,           <span class="st">"NIV"</span>),</span>
<span id="cb157-36"><a href="#cb157-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(abg_df,  <span class="st">"death_60d"</span>,                  <span class="st">"hypercap_on_abg"</span>, <span class="st">"w_abg"</span>,      <span class="st">"ABG"</span>,           <span class="st">"Death"</span>),</span>
<span id="cb157-37"><a href="#cb157-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(abg_df,  <span class="st">"hypercap_resp_failure"</span>, <span class="st">"hypercap_on_abg"</span>, <span class="st">"w_abg"</span>,      <span class="st">"ABG"</span>,           <span class="st">"ICD Code"</span>),</span>
<span id="cb157-38"><a href="#cb157-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-39"><a href="#cb157-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># VBG</span></span>
<span id="cb157-40"><a href="#cb157-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(vbg_df,  <span class="st">"imv_proc"</span>,              <span class="st">"hypercap_on_vbg"</span>, <span class="st">"w_vbg"</span>,      <span class="st">"VBG"</span>,           <span class="st">"Intubation"</span>),</span>
<span id="cb157-41"><a href="#cb157-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(vbg_df,  <span class="st">"niv_proc"</span>,              <span class="st">"hypercap_on_vbg"</span>, <span class="st">"w_vbg"</span>,      <span class="st">"VBG"</span>,           <span class="st">"NIV"</span>),</span>
<span id="cb157-42"><a href="#cb157-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(vbg_df,  <span class="st">"death_60d"</span>,                  <span class="st">"hypercap_on_vbg"</span>, <span class="st">"w_vbg"</span>,      <span class="st">"VBG"</span>,           <span class="st">"Death"</span>),</span>
<span id="cb157-43"><a href="#cb157-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(vbg_df,  <span class="st">"hypercap_resp_failure"</span>, <span class="st">"hypercap_on_vbg"</span>, <span class="st">"w_vbg"</span>,      <span class="st">"VBG"</span>,           <span class="st">"ICD Code"</span>),</span>
<span id="cb157-44"><a href="#cb157-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-45"><a href="#cb157-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculated ABG</span></span>
<span id="cb157-46"><a href="#cb157-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(calc_df, <span class="st">"imv_proc"</span>,              <span class="st">"hypercapnia_calc"</span>,<span class="st">"w_vbg_calc"</span>, <span class="st">"Calculated ABG"</span>,<span class="st">"Intubation"</span>),</span>
<span id="cb157-47"><a href="#cb157-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(calc_df, <span class="st">"niv_proc"</span>,              <span class="st">"hypercapnia_calc"</span>,<span class="st">"w_vbg_calc"</span>, <span class="st">"Calculated ABG"</span>,<span class="st">"NIV"</span>),</span>
<span id="cb157-48"><a href="#cb157-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(calc_df, <span class="st">"death_60d"</span>,                  <span class="st">"hypercapnia_calc"</span>,<span class="st">"w_vbg_calc"</span>, <span class="st">"Calculated ABG"</span>,<span class="st">"Death"</span>),</span>
<span id="cb157-49"><a href="#cb157-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_ipw</span>(calc_df, <span class="st">"hypercap_resp_failure"</span>, <span class="st">"hypercapnia_calc"</span>,<span class="st">"w_vbg_calc"</span>, <span class="st">"Calculated ABG"</span>,<span class="st">"ICD Code"</span>)</span>
<span id="cb157-50"><a href="#cb157-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb157-51"><a href="#cb157-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-52"><a href="#cb157-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. plotting ------------------------------------------------------------------</span></span>
<span id="cb157-53"><a href="#cb157-53" aria-hidden="true" tabindex="-1"></a>ipw_estimates<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb157-54"><a href="#cb157-54" aria-hidden="true" tabindex="-1"></a>  ipw_estimates<span class="sc">$</span>group,</span>
<span id="cb157-55"><a href="#cb157-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ABG"</span>, <span class="st">"VBG"</span>, <span class="st">"Calculated ABG"</span>)</span>
<span id="cb157-56"><a href="#cb157-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb157-57"><a href="#cb157-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-58"><a href="#cb157-58" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb157-59"><a href="#cb157-59" aria-hidden="true" tabindex="-1"></a>  ipw_estimates,</span>
<span id="cb157-60"><a href="#cb157-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb157-61"><a href="#cb157-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">x     =</span> outcome,</span>
<span id="cb157-62"><a href="#cb157-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">y     =</span> estimate,</span>
<span id="cb157-63"><a href="#cb157-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin  =</span> conf.low,</span>
<span id="cb157-64"><a href="#cb157-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax  =</span> conf.high,</span>
<span id="cb157-65"><a href="#cb157-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> group</span>
<span id="cb157-66"><a href="#cb157-66" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb157-67"><a href="#cb157-67" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb157-68"><a href="#cb157-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.6</span>), <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb157-69"><a href="#cb157-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb157-70"><a href="#cb157-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(</span>
<span id="cb157-71"><a href="#cb157-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>),</span>
<span id="cb157-72"><a href="#cb157-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="dv">16</span>),</span>
<span id="cb157-73"><a href="#cb157-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb157-74"><a href="#cb157-74" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb157-75"><a href="#cb157-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb157-76"><a href="#cb157-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb157-77"><a href="#cb157-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">title  =</span> <span class="st">"IP Weighted Odds Ratio of Outcomes When Hypercapnia Present"</span>,</span>
<span id="cb157-78"><a href="#cb157-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">x      =</span> <span class="st">"Outcome"</span>,</span>
<span id="cb157-79"><a href="#cb157-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">y      =</span> <span class="st">"Odds Ratio (log scale, 95 %&nbsp;CI)"</span>,</span>
<span id="cb157-80"><a href="#cb157-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">color  =</span> <span class="st">"Blood gas type"</span>,</span>
<span id="cb157-81"><a href="#cb157-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste</span>(</span>
<span id="cb157-82"><a href="#cb157-82" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Inverse‑probability weights adjust for covariates associated with receiving each blood‑gas."</span>,</span>
<span id="cb157-83"><a href="#cb157-83" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Models are fitted within their respective cohorts:"</span>,</span>
<span id="cb157-84"><a href="#cb157-84" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ABG (weights = w_abg), VBG (w_vbg), Calculated ABG (w_vbg_calc)."</span>,</span>
<span id="cb157-85"><a href="#cb157-85" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Numerator&nbsp;= hypercapnic; denominator&nbsp;= normocapnic within cohort."</span>,</span>
<span id="cb157-86"><a href="#cb157-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb157-87"><a href="#cb157-87" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb157-88"><a href="#cb157-88" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb157-89"><a href="#cb157-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb157-90"><a href="#cb157-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Three Groups with Weights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 1. Create PCO₂ categories ───────────────────────────────────────────────</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> subset_data <span class="sc">%&gt;%</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pco2_cat_abg =</span> <span class="fu">case_when</span>(</span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(paco2) <span class="sc">&amp;</span> paco2 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">"Below normal"</span>,</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(paco2) <span class="sc">&amp;</span> paco2 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> paco2 <span class="sc">&lt;=</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">"Normal"</span>,</span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(paco2) <span class="sc">&amp;</span> paco2 <span class="sc">&gt;</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">"Above normal"</span>,</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pco2_cat_vbg =</span> <span class="fu">case_when</span>(</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(vbg_co2) <span class="sc">&amp;</span> vbg_co2 <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">"Below normal"</span>,</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(vbg_co2) <span class="sc">&amp;</span> vbg_co2 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> vbg_co2 <span class="sc">&lt;=</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"Normal"</span>,</span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(vbg_co2) <span class="sc">&amp;</span> vbg_co2 <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"Above normal"</span>,</span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">pco2_cat_calc =</span> <span class="fu">case_when</span>(</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(calc_abg) <span class="sc">&amp;</span> calc_abg <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">"Below normal"</span>,</span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(calc_abg) <span class="sc">&amp;</span> calc_abg <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> calc_abg <span class="sc">&lt;=</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">"Normal"</span>,</span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(calc_abg) <span class="sc">&amp;</span> calc_abg <span class="sc">&gt;</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">"Above normal"</span>,</span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 2. Function: weighted logistic regression &amp; OR extraction ───────────────</span></span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a>run_weighted_or <span class="ot">&lt;-</span> <span class="cf">function</span>(data, outcome, cat_var, weight_var, group_name) {</span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb158-33"><a href="#cb158-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb158-34"><a href="#cb158-34" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(.data[[cat_var]]),</span>
<span id="cb158-35"><a href="#cb158-35" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(.data[[outcome]]),</span>
<span id="cb158-36"><a href="#cb158-36" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(.data[[weight_var]]),</span>
<span id="cb158-37"><a href="#cb158-37" aria-hidden="true" tabindex="-1"></a>      .data[[weight_var]] <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb158-38"><a href="#cb158-38" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb158-39"><a href="#cb158-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb158-40"><a href="#cb158-40" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="at">cat_var :=</span> <span class="fu">factor</span>(.data[[cat_var]],</span>
<span id="cb158-41"><a href="#cb158-41" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Normal"</span>, <span class="st">"Below normal"</span>, <span class="st">"Above normal"</span>))</span>
<span id="cb158-42"><a href="#cb158-42" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb158-43"><a href="#cb158-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">droplevels</span>()</span>
<span id="cb158-44"><a href="#cb158-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-45"><a href="#cb158-45" aria-hidden="true" tabindex="-1"></a>  design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb158-46"><a href="#cb158-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb158-47"><a href="#cb158-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">weights =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, weight_var)),</span>
<span id="cb158-48"><a href="#cb158-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat</span>
<span id="cb158-49"><a href="#cb158-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb158-50"><a href="#cb158-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-51"><a href="#cb158-51" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(outcome, <span class="st">"~"</span>, cat_var)),</span>
<span id="cb158-52"><a href="#cb158-52" aria-hidden="true" tabindex="-1"></a>                <span class="at">design =</span> design, <span class="at">family =</span> <span class="fu">quasibinomial</span>())</span>
<span id="cb158-53"><a href="#cb158-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-54"><a href="#cb158-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(fit, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb158-55"><a href="#cb158-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb158-56"><a href="#cb158-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb158-57"><a href="#cb158-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">group    =</span> group_name,</span>
<span id="cb158-58"><a href="#cb158-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">outcome  =</span> outcome,</span>
<span id="cb158-59"><a href="#cb158-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">exposure =</span> <span class="fu">gsub</span>(<span class="fu">paste0</span>(cat_var), <span class="st">""</span>, term) <span class="sc">%&gt;%</span></span>
<span id="cb158-60"><a href="#cb158-60" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">gsub</span>(<span class="st">"`"</span>, <span class="st">""</span>, .)</span>
<span id="cb158-61"><a href="#cb158-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb158-62"><a href="#cb158-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb158-63"><a href="#cb158-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-64"><a href="#cb158-64" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 3. Run across outcomes &amp; cohorts ────────────────────────────────────────</span></span>
<span id="cb158-65"><a href="#cb158-65" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"imv_proc"</span>, <span class="st">"niv_proc"</span>, <span class="st">"death_60d"</span>, <span class="st">"hypercap_resp_failure"</span>)</span>
<span id="cb158-66"><a href="#cb158-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-67"><a href="#cb158-67" aria-hidden="true" tabindex="-1"></a>combined_or_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb158-68"><a href="#cb158-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(outcomes, <span class="cf">function</span>(out)</span>
<span id="cb158-69"><a href="#cb158-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">run_weighted_or</span>(subset_data, out, <span class="st">"pco2_cat_abg"</span>,  <span class="st">"w_abg"</span>,      <span class="st">"ABG"</span>)),</span>
<span id="cb158-70"><a href="#cb158-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(outcomes, <span class="cf">function</span>(out)</span>
<span id="cb158-71"><a href="#cb158-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">run_weighted_or</span>(subset_data, out, <span class="st">"pco2_cat_vbg"</span>,  <span class="st">"w_vbg"</span>,      <span class="st">"VBG"</span>)),</span>
<span id="cb158-72"><a href="#cb158-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(outcomes, <span class="cf">function</span>(out)</span>
<span id="cb158-73"><a href="#cb158-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">run_weighted_or</span>(subset_data, out, <span class="st">"pco2_cat_calc"</span>, <span class="st">"w_vbg_calc"</span>, <span class="st">"Calculated ABG"</span>))</span>
<span id="cb158-74"><a href="#cb158-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb158-75"><a href="#cb158-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-76"><a href="#cb158-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure nice ordering</span></span>
<span id="cb158-77"><a href="#cb158-77" aria-hidden="true" tabindex="-1"></a>combined_or_df<span class="sc">$</span>group    <span class="ot">&lt;-</span> <span class="fu">factor</span>(combined_or_df<span class="sc">$</span>group,</span>
<span id="cb158-78"><a href="#cb158-78" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ABG"</span>, <span class="st">"VBG"</span>, <span class="st">"Calculated ABG"</span>))</span>
<span id="cb158-79"><a href="#cb158-79" aria-hidden="true" tabindex="-1"></a>combined_or_df<span class="sc">$</span>exposure <span class="ot">&lt;-</span> <span class="fu">factor</span>(combined_or_df<span class="sc">$</span>exposure,</span>
<span id="cb158-80"><a href="#cb158-80" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Below normal"</span>, <span class="st">"Above normal"</span>))</span>
<span id="cb158-81"><a href="#cb158-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-82"><a href="#cb158-82" aria-hidden="true" tabindex="-1"></a><span class="co"># ── 4. Plot weighted odds ratios ────────────────────────────────────────────</span></span>
<span id="cb158-83"><a href="#cb158-83" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb158-84"><a href="#cb158-84" aria-hidden="true" tabindex="-1"></a>  combined_or_df,</span>
<span id="cb158-85"><a href="#cb158-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb158-86"><a href="#cb158-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">x      =</span> outcome,</span>
<span id="cb158-87"><a href="#cb158-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">y      =</span> estimate,</span>
<span id="cb158-88"><a href="#cb158-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin   =</span> conf.low,</span>
<span id="cb158-89"><a href="#cb158-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax   =</span> conf.high,</span>
<span id="cb158-90"><a href="#cb158-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">color  =</span> group,</span>
<span id="cb158-91"><a href="#cb158-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape  =</span> exposure</span>
<span id="cb158-92"><a href="#cb158-92" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb158-93"><a href="#cb158-93" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb158-94"><a href="#cb158-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb158-95"><a href="#cb158-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb158-96"><a href="#cb158-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(</span>
<span id="cb158-97"><a href="#cb158-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>),</span>
<span id="cb158-98"><a href="#cb158-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="dv">16</span>),</span>
<span id="cb158-99"><a href="#cb158-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb158-100"><a href="#cb158-100" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb158-101"><a href="#cb158-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb158-102"><a href="#cb158-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb158-103"><a href="#cb158-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">title  =</span> <span class="st">"Weighted Odds Ratios of Outcomes by PCO₂ Category (ABG, VBG, Calc ABG)"</span>,</span>
<span id="cb158-104"><a href="#cb158-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">x      =</span> <span class="st">"Outcome"</span>,</span>
<span id="cb158-105"><a href="#cb158-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">y      =</span> <span class="st">"Odds Ratio (log scale, 95% CI)"</span>,</span>
<span id="cb158-106"><a href="#cb158-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">color  =</span> <span class="st">"Blood-gas type"</span>,</span>
<span id="cb158-107"><a href="#cb158-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape  =</span> <span class="st">"PCO₂ category"</span></span>
<span id="cb158-108"><a href="#cb158-108" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb158-109"><a href="#cb158-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb158-110"><a href="#cb158-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Plotting propensity scores</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Propensity score histograms (ABG / VBG / Calculated-ABG) -----------------</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ABG = arterial blood gas; VBG = venous blood gas</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve WeightIt objects regardless of naming used upstream</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>w_abg_obj      <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"w_abg"</span>)) w_abg <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"weight_model"</span>)) weight_model <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>w_vbg_obj      <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"w_vbg"</span>)) w_vbg <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>w_vbg_calc_obj <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"w_vbg_calc"</span>)) w_vbg_calc <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"w_vbg"</span>)) w_vbg <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(w_abg_obj)) <span class="fu">stop</span>(<span class="st">"ABG WeightIt object not found. Define `w_abg` or `weight_model` before this block."</span>)</span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"has_abg"</span> <span class="sc">%in%</span> <span class="fu">names</span>(subset_data)) <span class="fu">stop</span>(<span class="st">"`subset_data` must contain `has_abg` for ABG PS plotting."</span>)</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Build list of per-cohort PS data frames conditionally (so missing cohorts don't error)</span></span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a>ps_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">ABG =</span> <span class="fu">data.frame</span>(</span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">ps        =</span> w_abg_obj<span class="sc">$</span>ps,</span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat     =</span> subset_data<span class="sc">$</span>has_abg,</span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">ScoreType =</span> <span class="st">"ABG"</span></span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(w_vbg_obj) <span class="sc">&amp;&amp;</span> <span class="st">"has_vbg"</span> <span class="sc">%in%</span> <span class="fu">names</span>(subset_data)) {</span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a>  ps_dfs<span class="sc">$</span>VBG <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ps        =</span> w_vbg_obj<span class="sc">$</span>ps,</span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat     =</span> subset_data<span class="sc">$</span>has_vbg,</span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">ScoreType =</span> <span class="st">"VBG"</span></span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.null</span>(w_vbg_obj)) {</span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Note: VBG WeightIt object `w_vbg` not found; skipping VBG panel."</span>)</span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-35"><a href="#cb159-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculated ABG uses the VBG selection model; prefer a dedicated `w_vbg_calc` if present</span></span>
<span id="cb159-36"><a href="#cb159-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(w_vbg_calc_obj) <span class="sc">&amp;&amp;</span> <span class="st">"has_vbg_co2_o2_sat"</span> <span class="sc">%in%</span> <span class="fu">names</span>(subset_data)) {</span>
<span id="cb159-37"><a href="#cb159-37" aria-hidden="true" tabindex="-1"></a>  ps_dfs<span class="sc">$</span>CalcABG <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb159-38"><a href="#cb159-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">ps        =</span> w_vbg_calc_obj<span class="sc">$</span>ps,</span>
<span id="cb159-39"><a href="#cb159-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat     =</span> subset_data<span class="sc">$</span>has_vbg_co2_o2_sat,</span>
<span id="cb159-40"><a href="#cb159-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">ScoreType =</span> <span class="st">"Calculated ABG"</span></span>
<span id="cb159-41"><a href="#cb159-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb159-42"><a href="#cb159-42" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.null</span>(w_vbg_calc_obj)) {</span>
<span id="cb159-43"><a href="#cb159-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Note: Calculated-ABG WeightIt object `w_vbg_calc` (or fallback `w_vbg`) not found; skipping Calc-ABG panel."</span>)</span>
<span id="cb159-44"><a href="#cb159-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb159-45"><a href="#cb159-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-46"><a href="#cb159-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind, clean, and factorize for plotting</span></span>
<span id="cb159-47"><a href="#cb159-47" aria-hidden="true" tabindex="-1"></a>df_ps <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ps_dfs) <span class="sc">%&gt;%</span></span>
<span id="cb159-48"><a href="#cb159-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ps), <span class="sc">!</span><span class="fu">is.na</span>(treat)) <span class="sc">%&gt;%</span></span>
<span id="cb159-49"><a href="#cb159-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb159-50"><a href="#cb159-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">treat     =</span> <span class="fu">factor</span>(treat, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No Test"</span>, <span class="st">"Test"</span>)),</span>
<span id="cb159-51"><a href="#cb159-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">ScoreType =</span> <span class="fu">factor</span>(ScoreType, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"ABG"</span>, <span class="st">"VBG"</span>, <span class="st">"Calculated ABG"</span>))</span>
<span id="cb159-52"><a href="#cb159-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb159-53"><a href="#cb159-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-54"><a href="#cb159-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb159-55"><a href="#cb159-55" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_ps, <span class="fu">aes</span>(<span class="at">x =</span> ps, <span class="at">fill =</span> treat)) <span class="sc">+</span></span>
<span id="cb159-56"><a href="#cb159-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb159-57"><a href="#cb159-57" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb159-58"><a href="#cb159-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"No Test"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>, <span class="st">"Test"</span> <span class="ot">=</span> <span class="st">"tomato"</span>)) <span class="sc">+</span></span>
<span id="cb159-59"><a href="#cb159-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ScoreType, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb159-60"><a href="#cb159-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb159-61"><a href="#cb159-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb159-62"><a href="#cb159-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Propensity Score Distributions"</span>,</span>
<span id="cb159-63"><a href="#cb159-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">x     =</span> <span class="st">"Propensity score"</span>,</span>
<span id="cb159-64"><a href="#cb159-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">y     =</span> <span class="st">"Density"</span>,</span>
<span id="cb159-65"><a href="#cb159-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill  =</span> <span class="st">"Group"</span></span>
<span id="cb159-66"><a href="#cb159-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb159-67"><a href="#cb159-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ABG-VBG-analysis-2025-9-15_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<pre><code></code></pre>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>